<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>倉庫スペース計算機</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📦 倉庫スペース計算機</h1>
            <p>パレットの寸法と数量から必要なスペースを計算します</p>
        </div>

        <!-- Main Tab Navigation -->
        <div class="main-tab-navigation">
            <button class="main-tab-button active" data-tab="input">📝 入力</button>
            <button class="main-tab-button" data-tab="layout">🗺️ レイアウト</button>
            <button class="main-tab-button" data-tab="summary">📋 サマリー</button>
        </div>

        <!-- Input Tab -->
        <div id="input-tab" class="main-tab-content active">
            <div class="content">
                <div class="main-content">
                    <div class="input-section">
                        <!-- Warehouse Settings -->
                        <div class="form-section">
                            <h2>🏗️ 倉庫設定</h2>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="warehouseName">倉庫名</label>
                                    <input type="text" id="warehouseName" class="form-input" placeholder="倉庫名（オプション）">
                                </div>
                                <div class="form-group">
                                    <label for="warehouseLength">長さ (m)</label>
                                    <input type="number" id="warehouseLength" class="form-input" value="50" min="1" step="0.1">
                                </div>
                                <div class="form-group">
                                    <label for="warehouseWidth">幅 (m)</label>
                                    <input type="number" id="warehouseWidth" class="form-input" value="40" min="1" step="0.1">
                                </div>
                                <div class="form-group">
                                    <label for="warehouseHeight">高さ (m)</label>
                                    <input type="number" id="warehouseHeight" class="form-input" value="9" min="1" step="0.1">
                                </div>
                            </div>
                            
                            <!-- Add this new button row -->
                            <div class="form-row">
                                <div class="form-group">
                                    <button id="autoCalculateWarehouseBtn" class="btn" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                                        🎯 最適倉庫サイズ自動計算
                                    </button>
                                    <small class="text-gray-500 text-sm">選択されたパレットに基づいて最適な倉庫サイズを計算します</small>
                                </div>
                            </div>
                        </div>

                        <!-- Pallet Management -->
                        <div class="form-section">
                            <h2>📦 パレット管理</h2>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="palletName">パレット名</label>
                                    <input type="text" id="palletName" class="form-input" placeholder="パレット名">
                                </div>
                                <div class="form-group">
                                    <label for="palletLength">長さ (m)</label>
                                    <input type="number" id="palletLength" class="form-input" value="1.1" min="0.1" step="0.1">
                                </div>
                                <div class="form-group">
                                    <label for="palletWidth">幅 (m)</label>
                                    <input type="number" id="palletWidth" class="form-input" value="1.1" min="0.1" step="0.1">
                                </div>
                                <div class="form-group">
                                    <label for="palletHeight">高さ (m)</label>
                                    <input type="number" id="palletHeight" class="form-input" value="1.1" min="0.1" step="0.1">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="palletQuantity">数量</label>
                                    <input type="number" id="palletQuantity" class="form-input" value="10" min="1">
                                </div>
                                <div class="form-group">
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="isStackable" checked>
                                        <label for="isStackable">段積み可能</label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="maxStackHeight">最大積み重ね高さ (m)</label>
                                    <input type="number" id="maxStackHeight" class="form-input" value="3.0" min="0.1" step="0.1">
                                </div>
                            </div>
                            <button id="addPalletBtn" class="btn">➕ パレット追加</button>
                            
                            <div id="palletList" class="pallet-list">
                                <!-- Pallets will be added here -->
                            </div>
                        </div>
                    </div>

                    <div class="output-section">
                        <!-- Space Calculation Controls -->
                        <div class="form-section">
                            <h2>📐 スペース計算</h2>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="selectedPallets">計算対象パレット（複数選択可能）</label>
                                    <select id="selectedPallets" class="form-input" multiple size="4">
                                        <option value="">パレットを選択してください</option>
                                    </select>
                                    <small class="text-gray-500 text-sm">Ctrl+クリックで複数選択</small>
                                </div>
                                <div class="form-group">
                                    <div class="checkbox-group">
                                        <input type="checkbox" id="includeAisles" checked>
                                        <label for="includeAisles">通路を含める</label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="aisleWidth">通路幅 (m)</label>
                                    <input type="number" id="aisleWidth" class="form-input" value="2.5" min="0.5" step="0.1">
                                </div>
                                <div class="form-group">
                                    <label for="palletClearance">パレット間クリアランス (cm)</label>
                                    <input type="number" id="palletClearance" class="form-input" value="5" min="0" step="1" max="100">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="calculationMode">計算モード</label>
                                    <select id="calculationMode" class="form-input">
                                        <option value="combined">統合計算（全パレットを同時配置）</option>
                                        <option value="separate">個別計算（各パレットタイプ別）</option>
                                    </select>
                                </div>
                            </div>
                            <button id="calculateBtn" class="btn">📐 スペース計算実行</button>
                            
                            <!-- Debug Export Section -->
                            <div class="form-row" style="margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid #e5e7eb;">
                                <div class="form-group">
                                    <label style="color: #6b7280; font-size: 0.875rem; margin-bottom: 0.5rem;">🔧 デバッグエクスポート</label>
                                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                                        <button id="exportDebugCSVBtn" class="btn btn-sm" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);">
                                            📊 CSV エクスポート
                                        </button>
                                        <button id="exportDebugJSONBtn" class="btn btn-sm" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                                            📄 JSON エクスポート
                                        </button>
                                    </div>
                                    <small class="text-gray-500 text-sm">ユーザー入力値と処理済み値をエクスポートしてレイアウト生成器の改善に活用</small>
                                </div>
                            </div>
                        </div>

                        <!-- Calculation Results -->
                        <div id="calculationResults" class="results hidden">
                            <h3>📊 計算結果</h3>
                            <div class="result-grid">
                                <div class="result-item">
                                    <div class="result-value" id="requiredArea">0</div>
                                    <div class="result-label">必要面積 (m²)</div>
                                </div>
                                <div class="result-item">
                                    <div class="result-value" id="stackingLevels">1</div>
                                    <div class="result-label">段積み段数</div>
                                </div>
                                <div class="result-item">
                                    <div class="result-value" id="palletsPerRow">0</div>
                                    <div class="result-label">1列あたりのパレット数</div>
                                </div>
                                <div class="result-item">
                                    <div class="result-value" id="totalRows">0</div>
                                    <div class="result-label">必要列数</div>
                                </div>
                                <div class="result-item">
                                    <div class="result-value" id="utilizationRate">0%</div>
                                    <div class="result-label">倉庫利用率</div>
                                </div>
                                <div class="result-item">
                                    <div class="result-value" id="efficiency">0%</div>
                                    <div class="result-label">配置効率</div>
                                </div>
                            </div>
                            <div class="mt-4">
                                <div class="efficiency-display">
                                    <span>配置効率</span>
                                    <span id="efficiencyText">0%</span>
                                </div>
                                <div class="efficiency-bar">
                                    <div class="efficiency-fill" id="efficiencyBar"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Message Container -->
                        <div id="messageContainer"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Summary Tab -->
        <div id="summary-tab" class="main-tab-content">
            <div class="summary-section">
                <h2>📋 計算サマリー</h2>
                <div class="summary-grid">
                    <div class="summary-card">
                        <h4>🏗️ 倉庫情報</h4>
                        <div class="summary-item">
                            <span class="summary-label">倉庫名</span>
                            <span class="summary-value" id="summaryWarehouseName">-</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">寸法</span>
                            <span class="summary-value" id="summaryWarehouseDimensions">-</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">総面積</span>
                            <span class="summary-value" id="summaryWarehouseArea">-</span>
                        </div>
                    </div>
                    
                    <div class="summary-card">
                        <h4>📦 パレット情報</h4>
                        <div class="summary-item">
                            <span class="summary-label">パレット種類数</span>
                            <span class="summary-value" id="summaryPalletTypes">-</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">総パレット数</span>
                            <span class="summary-value" id="summaryTotalPallets">-</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">計算モード</span>
                            <span class="summary-value" id="summaryCalculationMode">-</span>
                        </div>
                    </div>
                    
                    <div class="summary-card">
                        <h4>📐 スペース計算</h4>
                        <div class="summary-item">
                            <span class="summary-label">必要面積</span>
                            <span class="summary-value highlight" id="summaryRequiredArea">-</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">最大段積み</span>
                            <span class="summary-value" id="summaryMaxStacking">-</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">配置効率</span>
                            <span class="summary-value highlight" id="summaryEfficiency">-</span>
                        </div>
                    </div>
                    
                    <div class="summary-card">
                        <h4>⚙️ 設定</h4>
                        <div class="summary-item">
                            <span class="summary-label">通路幅</span>
                            <span class="summary-value" id="summaryAisleWidth">-</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">クリアランス</span>
                            <span class="summary-value" id="summaryClearance">-</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">通路を含む</span>
                            <span class="summary-value" id="summaryIncludeAisles">-</span>
                        </div>
                    </div>
                </div>
                
                <div class="summary-card">
                    <h4>📊 詳細パレット情報</h4>
                    <div id="summaryPalletDetails">
                        <p class="text-center text-gray-500 p-4">パレットが選択されていません</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Layout Tab -->
        <div id="layout-tab" class="main-tab-content">
            <div class="layout-section">
                <h2>🗺️ レイアウト表示</h2>
                <div class="layout-info">
                    <small class="text-gray-500">選択されたパレットの最適なレイアウトが自動生成されます</small>
                </div>
                <div id="layoutContainer" class="layout-container">
                    <canvas id="layoutCanvas" class="warehouse-canvas"></canvas>
                    <div id="warehouseLayout" class="warehouse-layout" style="display: none;"></div>
                </div>
                <div id="layoutLegend" class="layout-legend"></div>
            </div>
        </div>
    </div>

    <!-- Load modules in dependency order -->
    <script src="input.js"></script>
    <script src="layout.js"></script>
    <script src="summary.js"></script>
    <script src="layout-generator.js"></script>
    <script src="debug-export.js"></script>
    <script src="main.js"></script>
</body>
</html>