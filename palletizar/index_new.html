<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>パレタイズ最適化計算機 v2.0</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <h1>パレタイズ最適化計算機 v2.0</h1>
        <p class="subtitle">モジュール化・最適化版</p>

        <div class="improvement-note">
            <h3>📋 使用方法</h3>
            <ol style="margin-left: 20px;">
                <li><strong>貨物データの入力</strong>：「📄 CSVインポート」で一括追加または「➕ 新規追加」で個別入力</li>
                <li><strong>CSVテンプレート</strong>：「📥 CSVテンプレート」をダウンロードしてExcelで編集可能</li>
                <li><strong>高さ制限設定</strong>：用途に応じて積載高さの上限を調整</li>
                <li><strong>パレット種類選択</strong>：使用するパレットサイズを選択</li>
                <li><strong>パレタイズ計算</strong>：「🔢 パレタイズ計算を実行」で最適配置を自動計算</li>
                <li><strong>結果確認</strong>：配置図で視覚的に確認、パレット番号クリックで詳細表示</li>
                <li><strong>データ管理</strong>：「🗑️ 一括削除」で全データをクリア可能</li>
            </ol>
        </div>

        <!-- エラー表示エリア -->
        <div id="errors"></div>

        <!-- 貨物情報サマリー -->
        <div class="summary-grid">
            <div class="summary-card blue">
                <h3>総カートン数</h3>
                <p id="totalCartons">0</p>
            </div>
            <div class="summary-card green">
                <h3>総重量</h3>
                <p id="totalWeight">0 kg</p>
            </div>
            <div class="summary-card purple">
                <h3>品目数</h3>
                <p id="itemCount">0</p>
            </div>
        </div>

        <!-- 貨物詳細テーブル -->
        <div class="section">
            <div class="section-header">
                <h2>貨物詳細</h2>
                <div class="flex gap-2">
                    <button id="downloadTemplateButton" class="btn btn-secondary">📥 CSVテンプレート</button>
                    <button id="importButton" class="btn btn-primary">📄 CSVインポート</button>
                    <button id="clearAllButton" class="btn btn-danger">🗑️ 一括削除</button>
                    <button id="addButton" class="btn btn-success">➕ 新規追加</button>
                </div>
            </div>
            
            <!-- CSVインポートエリア -->
            <div id="importArea" class="add-form hidden">
                <h3>CSVファイルをインポート</h3>
                <div style="margin-bottom: 15px;">
                    <input type="file" id="csvFileInput" accept=".csv" class="form-input" style="margin-bottom: 10px;">
                    <div style="font-size: 0.9rem; color: #666;">
                        <strong>CSV形式:</strong> 貨物コード, 数量, 重量(kg), 長さ(cm), 幅(cm), 高さ(cm)<br>
                        <strong>例:</strong> SAMPLE, 100, 5.5, 40.0, 30.0, 25.0
                    </div>
                </div>
                <div class="flex gap-2">
                    <button id="executeImportButton" class="btn btn-primary">📥 インポート実行</button>
                    <button id="cancelImportButton" class="btn btn-secondary">❌ キャンセル</button>
                </div>
            </div>
            
            <!-- 新規追加フォーム -->
            <div id="addForm" class="add-form hidden">
                <h3>新規貨物追加</h3>
                <div class="form-grid">
                    <input type="text" id="addCode" placeholder="貨物コード" class="form-input" required>
                    <input type="number" id="addQty" placeholder="数量" class="form-input" min="1" required>
                    <input type="number" id="addWeight" placeholder="重量(kg)" class="form-input" step="0.1" min="0.1" required>
                    <input type="number" id="addLength" placeholder="長さ(cm)" class="form-input" step="0.1" min="1" required>
                    <input type="number" id="addWidth" placeholder="幅(cm)" class="form-input" step="0.1" min="1" required>
                    <input type="number" id="addHeight" placeholder="高さ(cm)" class="form-input" step="0.1" min="1" required>
                </div>
                <div class="flex gap-2">
                    <button id="saveAddButton" class="btn btn-primary">💾 保存</button>
                    <button id="cancelAddButton" class="btn btn-secondary">❌ キャンセル</button>
                </div>
            </div>
            
            <!-- 貨物テーブル -->
            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th>貨物コード</th>
                            <th>数量</th>
                            <th>重量(kg)</th>
                            <th>寸法(cm)</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="cartonTableBody">
                        <!-- 動的に生成 -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 高さ制限設定 -->
        <div class="height-limit-setting">
            <h3>📏 高さ制限設定</h3>
            <div class="height-limit-controls">
                <div class="height-input-group">
                    <label>最大積載高さ（パレット含む）</label>
                    <div class="height-input-wrapper">
                        <input type="number" id="heightLimitInput" min="50" max="300" value="158" class="form-input">
                        <span class="height-unit">cm</span>
                    </div>
                    <div class="height-presets">
                        <button class="height-preset-btn" onclick="setHeightLimit(100)">100cm</button>
                        <button class="height-preset-btn" onclick="setHeightLimit(120)">120cm</button>
                        <button class="height-preset-btn" onclick="setHeightLimit(140)">140cm</button>
                        <button class="height-preset-btn active" onclick="setHeightLimit(158)">158cm</button>
                        <button class="height-preset-btn" onclick="setHeightLimit(180)">180cm</button>
                        <button class="height-preset-btn" onclick="setHeightLimit(200)">200cm</button>
                    </div>
                </div>
                <div class="height-info">
                    <h4>現在の設定</h4>
                    <div class="height-current-display">
                        高さ制限: <span id="heightLimitDisplay">158</span>cm
                    </div>
                    <ul>
                        <li>パレット台座: 14cm（固定）</li>
                        <li>カートン配置可能高さ: <span id="availableHeight">144</span>cm</li>
                    </ul>
                </div>
            </div>
            <div id="heightWarning" class="height-warning hidden">
                ⚠️ 180cmを超える設定は特殊な輸送手段が必要な場合があります
            </div>
        </div>

        <!-- パレット種類選択 -->
        <div class="pallet-selection">
            <h3>📦 使用パレット種類</h3>
            <div id="palletOptions" class="pallet-options">
                <!-- 動的に生成 -->
            </div>
            <div class="pallet-selection-actions">
                <button id="selectAllPallets" class="btn btn-secondary btn-sm">すべて選択</button>
                <button id="deselectAllPallets" class="btn btn-secondary btn-sm">すべて解除</button>
                <span id="selectedPalletsInfo" style="margin-left: 10px; color: #16a34a;">✅ 5種類のパレットで最適化計算</span>
            </div>
        </div>

        <!-- 計算実行ボタン -->
        <div class="center" style="margin: 30px 0;">
            <button id="calculateButton" class="btn btn-primary btn-lg">
                🔢 パレタイズ計算を実行
            </button>
            <div id="loadingIndicator" class="loading">
                <div class="spinner"></div>
                <span style="margin-left: 10px;">計算中...</span>
            </div>
        </div>

        <!-- 計算結果 -->
        <div id="results" class="result-section hidden">
            <div class="result-header">
                <h2>📊 パレタイズ結果</h2>
                <div class="flex gap-2">
                    <button id="exportButton" class="btn btn-success">📥 CSVエクスポート</button>
                </div>
            </div>

            <!-- サマリーテーブル -->
            <div id="summarySection" class="section">
                <h3>パレット一覧</h3>
                <div class="table-container">
                    <table class="summary-table">
                        <thead>
                            <tr>
                                <th>No.</th>
                                <th>寸法(cm)</th>
                                <th>重量(kg)</th>
                                <th>貨物コード</th>
                                <th>数量</th>
                            </tr>
                        </thead>
                        <tbody id="summaryBody">
                            <!-- 動的に生成 -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- パレット詳細 -->
            <div id="palletResults">
                <!-- 動的に生成 -->
            </div>

            <!-- パレット結合機能 -->
            <div id="combineSection" class="section">
                <h3>🔄 パレット最適化</h3>
                <div class="combine-controls">
                    <div>
                        <label>パレット1:</label>
                        <select id="pallet1Select" class="form-input">
                            <!-- 動的に生成 -->
                        </select>
                    </div>
                    <div>
                        <label>パレット2:</label>
                        <select id="pallet2Select" class="form-input">
                            <!-- 動的に生成 -->
                        </select>
                    </div>
                    <button id="combineButton" class="btn btn-primary">結合実行</button>
                    <button id="analyzeButton" class="btn btn-secondary">分析</button>
                    <button id="autoOptimizeButton" class="btn btn-success">自動最適化</button>
                </div>
                <div id="combinePreview" style="margin-top: 15px;">
                    <!-- 動的に生成 -->
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript モジュール読み込み -->
    <script type="module" src="js/app.js"></script>
</body>
</html>