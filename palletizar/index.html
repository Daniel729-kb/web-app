<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‘ãƒ¬ã‚¿ã‚¤ã‚ºæœ€é©åŒ–è¨ˆç®—æ©Ÿ</title>
    
    <!-- å…±é€šCSSãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ -->
    <link rel="stylesheet" href="../styles/variables.css">
    <link rel="stylesheet" href="../styles/components.css">
    <link rel="stylesheet" href="palletizar-specific.css">
</head>
<body>
    <div class="container">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
        <div class="header-controls" style="position: absolute; top: 24px; right: 32px; display: flex; gap: 12px; align-items: center; z-index: 10;">
            <button class="dark-mode-toggle" onclick="toggleDarkMode()" title="ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ" style="background: rgba(255, 255, 255, 0.1); border: none; border-radius: 6px; padding: 8px; color: rgba(255, 255, 255, 0.8); cursor: pointer; transition: all 0.2s ease; font-size: 16px; display: flex; align-items: center; justify-content: center; width: 36px; height: 32px;">
                <span class="dark-mode-icon">ğŸŒ™</span>
            </button>
        </div>

        <div class="header">
            <h1>ğŸ“¦ ãƒ‘ãƒ¬ã‚¿ã‚¤ã‚ºæœ€é©åŒ–è¨ˆç®—æ©Ÿ by Daniel</h1>
            <p>é«˜ã•åˆ¶é™å¯¾å¿œãƒ»é…ç½®åŠ¹ç‡æœ€é©åŒ–ã‚·ã‚¹ãƒ†ãƒ </p>
        </div>

        <div style="padding: 32px;">
            <div class="improvement-note">
                <h3>ğŸ“‹ ä½¿ç”¨æ–¹æ³•</h3>
                <ol>
                    <li><strong>è²¨ç‰©ãƒ‡ãƒ¼ã‚¿ã®å…¥åŠ›</strong>ï¼šã€ŒğŸ“„ CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆã€ã§ä¸€æ‹¬è¿½åŠ ã¾ãŸã¯ã€Œâ• æ–°è¦è¿½åŠ ã€ã§å€‹åˆ¥å…¥åŠ›</li>
                    <li><strong>CSVãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</strong>ï¼šã€ŒğŸ“¥ CSVãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã€ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦Excelã§ç·¨é›†å¯èƒ½</li>
                    <li><strong>é«˜ã•åˆ¶é™è¨­å®š</strong>ï¼šç”¨é€”ã«å¿œã˜ã¦ç©è¼‰é«˜ã•ã®ä¸Šé™ã‚’èª¿æ•´</li>
                    <li><strong>ãƒ‘ãƒ¬ãƒƒãƒˆç¨®é¡é¸æŠ</strong>ï¼šä½¿ç”¨ã™ã‚‹ãƒ‘ãƒ¬ãƒƒãƒˆã‚µã‚¤ã‚ºã‚’é¸æŠ</li>
                    <li><strong>ãƒ‘ãƒ¬ã‚¿ã‚¤ã‚ºè¨ˆç®—</strong>ï¼šã€ŒğŸ”¢ ãƒ‘ãƒ¬ã‚¿ã‚¤ã‚ºè¨ˆç®—ã‚’å®Ÿè¡Œã€ã§æœ€é©é…ç½®ã‚’è‡ªå‹•è¨ˆç®—</li>
                    <li><strong>çµæœç¢ºèª</strong>ï¼šé…ç½®å›³ï¼ˆå´é¢å›³ãƒ»å±¤åˆ¥é…ç½®ï¼‰ã§è¦–è¦šçš„ã«ç¢ºèªã€ãƒ‘ãƒ¬ãƒƒãƒˆç•ªå·ã‚¯ãƒªãƒƒã‚¯ã§è©³ç´°è¡¨ç¤º</li>
                    <li><strong>ãƒ‡ãƒ¼ã‚¿ç®¡ç†</strong>ï¼šã€ŒğŸ—‘ï¸ ä¸€æ‹¬å‰Šé™¤ã€ã§å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢å¯èƒ½</li>
                </ol>
            </div>

            <!-- ã‚¨ãƒ©ãƒ¼è¡¨ç¤º -->
            <div id="errors"></div>

            <!-- è²¨ç‰©æƒ…å ±ã‚µãƒãƒªãƒ¼ -->
            <div class="summary-grid">
                <div class="summary-card blue">
                    <h3>ç·ã‚«ãƒ¼ãƒˆãƒ³æ•°</h3>
                    <p id="totalCartons">0</p>
                </div>
                <div class="summary-card green">
                    <h3>ç·é‡é‡</h3>
                    <p id="totalWeight">0 kg</p>
                </div>
                <div class="summary-card purple">
                    <h3>å“ç›®æ•°</h3>
                    <p id="itemCount">0 ç¨®é¡</p>
                </div>
            </div>

            <!-- è²¨ç‰©è©³ç´°ãƒ†ãƒ¼ãƒ–ãƒ« -->
            <div class="section">
                <div class="section-header">
                    <h2>è²¨ç‰©è©³ç´°</h2>
                    <div class="flex gap-2">
                        <button id="downloadTemplateButton" class="btn btn-secondary">ğŸ“¥ CSVãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</button>
                        <button id="importButton" class="btn btn-primary">ğŸ“„ CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
                        <button id="clearAllButton" class="btn btn-danger">ğŸ—‘ï¸ ä¸€æ‹¬å‰Šé™¤</button>
                        <button id="addButton" class="btn btn-success">â• æ–°è¦è¿½åŠ </button>
                    </div>
                </div>
                
                <!-- CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒªã‚¢ -->
                <div id="importArea" class="add-form hidden">
                    <h3>CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</h3>
                    <div style="margin-bottom: 15px;">
                        <input type="file" id="csvFileInput" accept=".csv" class="form-input" style="margin-bottom: 10px;">
                        <div style="font-size: 0.9rem; color: #666;">
                            <strong>CSVå½¢å¼:</strong> è²¨ç‰©ã‚³ãƒ¼ãƒ‰, æ•°é‡, é‡é‡(kg), é•·ã•(cm), å¹…(cm), é«˜ã•(cm)<br>
                            <strong>ä¾‹:</strong> SAMPLE, 209, 6.70, 53.0, 38.5, 23.5
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <button id="executeImportButton" class="btn btn-primary">ğŸ“¥ ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Ÿè¡Œ</button>
                        <button id="cancelImportButton" class="btn btn-secondary">âŒ ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    </div>
                </div>
                
                <!-- æ–°è¦è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ  -->
                <div id="addForm" class="add-form hidden">
                    <h3>æ–°ã—ã„ã‚«ãƒ¼ãƒˆãƒ³ã‚’è¿½åŠ </h3>
                    <div class="form-grid">
                        <input type="text" id="newCode" placeholder="è²¨ç‰©ã‚³ãƒ¼ãƒ‰" class="form-input">
                        <input type="number" id="newQty" placeholder="æ•°é‡" class="form-input">
                        <input type="number" id="newWeight" placeholder="é‡é‡(kg)" step="0.1" class="form-input">
                        <input type="number" id="newL" placeholder="é•·ã•(cm)" step="0.1" class="form-input">
                        <input type="number" id="newW" placeholder="å¹…(cm)" step="0.1" class="form-input">
                        <input type="number" id="newH" placeholder="é«˜ã•(cm)" step="0.1" class="form-input">
                    </div>
                    <div class="flex gap-2">
                        <button id="saveAddButton" class="btn btn-primary">ğŸ’¾ è¿½åŠ </button>
                        <button id="cancelAddButton" class="btn btn-secondary">âŒ ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    </div>
                </div>

                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>è²¨ç‰©ã‚³ãƒ¼ãƒ‰</th>
                                <th>æ•°é‡</th>
                                <th>é‡é‡ (kg)</th>
                                <th>é•·ã• (cm)</th>
                                <th>å¹… (cm)</th>
                                <th>é«˜ã• (cm)</th>
                                <th>ä½“ç© (ã¥)</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="cartonTableBody">
                            <!-- ãƒ‡ãƒ¼ã‚¿ã¯JavaScriptã§æŒ¿å…¥ -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- é«˜ã•åˆ¶é™è¨­å®š -->
            <div class="height-limit-setting">
                <h3>ğŸ“ ç©è¼‰é«˜ã•åˆ¶é™è¨­å®š</h3>
                <div class="height-limit-controls">
                    <div class="height-input-group">
                        <label for="heightLimitInput">æœ€å¤§ç©è¼‰é«˜ã•</label>
                        <div class="height-input-wrapper">
                            <input type="number" id="heightLimitInput" value="158" min="50" max="300" step="1">
                            <span class="height-unit">cm</span>
                        </div>
                        <div class="height-current-display">
                            ç¾åœ¨ã®åˆ¶é™: <span id="heightLimitDisplay">158</span>cm
                        </div>
                        <div class="height-presets">
                            <button class="height-preset-btn" onclick="setHeightLimit(120)">ã‚³ãƒ³ãƒ†ãƒŠæ¨™æº– (120cm)</button>
                            <button class="height-preset-btn active" onclick="setHeightLimit(158)">ä¸€èˆ¬ãƒ‘ãƒ¬ãƒƒãƒˆ (158cm)</button>
                            <button class="height-preset-btn" onclick="setHeightLimit(180)">é«˜ç©è¼‰ (180cm)</button>
                            <button class="height-preset-btn" onclick="setHeightLimit(200)">å€‰åº«å†…å°‚ç”¨ (200cm)</button>
                        </div>
                    </div>
                    <div class="height-info">
                        <h4>ğŸ’¡ é«˜ã•åˆ¶é™ã«ã¤ã„ã¦</h4>
                        <ul>
                            <li><strong>120cm:</strong> æµ·ä¸Šã‚³ãƒ³ãƒ†ãƒŠè¼¸é€å‘ã‘ï¼ˆå®‰å…¨ãƒãƒ¼ã‚¸ãƒ³è€ƒæ…®ï¼‰</li>
                            <li><strong>158cm:</strong> ä¸€èˆ¬çš„ãªãƒ‘ãƒ¬ãƒƒãƒˆç©è¼‰æ¨™æº–é«˜ã•</li>
                            <li><strong>180cm:</strong> ãƒˆãƒ©ãƒƒã‚¯è¼¸é€ã§ã®é«˜ç©è¼‰ç”¨é€”</li>
                            <li><strong>200cmä»¥ä¸Š:</strong> å€‰åº«å†…ä¿ç®¡å°‚ç”¨ï¼ˆè¼¸é€åˆ¶é™ã‚ã‚Šï¼‰</li>
                        </ul>
                        <div id="heightWarning" class="height-warning hidden">
                            âš ï¸ è¨­å®šã•ã‚ŒãŸé«˜ã•åˆ¶é™ã¯ä¸€èˆ¬çš„ãªè¼¸é€åˆ¶é™ã‚’è¶…ãˆã¦ã„ã¾ã™ã€‚ç”¨é€”ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
                        </div>
                    </div>
                </div>
            </div>

            <!-- ãƒ‘ãƒ¬ãƒƒãƒˆç¨®é¡é¸æŠ -->
            <div class="pallet-selection">
                <h3>ğŸ—ï¸ ä½¿ç”¨ã™ã‚‹ãƒ‘ãƒ¬ãƒƒãƒˆç¨®é¡ã‚’é¸æŠ</h3>
                <div class="pallet-options" id="palletOptions">
                    <!-- ãƒ‘ãƒ¬ãƒƒãƒˆé¸æŠè‚¢ã¯JavaScriptã§ç”Ÿæˆ -->
                </div>
                <div class="pallet-selection-actions">
                    <button id="selectAllPallets" class="btn btn-secondary btn-sm">âœ“ å…¨ã¦é¸æŠ</button>
                    <button id="deselectAllPallets" class="btn btn-secondary btn-sm">âœ— å…¨ã¦è§£é™¤</button>
                    <span id="selectedPalletsInfo" style="color: #666; font-size: 0.9rem; padding: 8px 0;"></span>
                </div>
            </div>

            <!-- è¨ˆç®—ãƒœã‚¿ãƒ³ -->
            <div class="text-center">
                <button id="calculateButton" class="btn btn-primary btn-lg">ğŸ”¢ ãƒ‘ãƒ¬ã‚¿ã‚¤ã‚ºè¨ˆç®—ã‚’å®Ÿè¡Œ</button>
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <span style="margin-left: 10px;">æœ€é©åŒ–è¨ˆç®—ä¸­...</span>
            </div>

            <!-- çµæœè¡¨ç¤º -->
            <div id="results" class="hidden">
                <div class="result-section">
                    <div class="result-header">
                        <h2>ğŸš› æœ€é©åŒ–çµæœ</h2>
                    
            <!-- ãƒ‘ãƒ¬ã‚¿ã‚¤ã‚ºã‚µãƒãƒªãƒ¼ -->
            <div id="summarySection" class="hidden">
                <h2 style="margin-top:1rem;">ãƒ‘ãƒ¬ã‚¿ã‚¤ã‚ºçµæœã‚µãƒãƒªãƒ¼</h2>
                <table class="summary-table">
                    <thead>
                        <tr>
                            <th>ãƒ‘ãƒ¬ãƒƒãƒˆNo</th>
                            <th>å¯¸æ³• (cm)</th>
                            <th>é‡é‡ (kg)</th>
                            <th>è²¨ç‰©ã‚³ãƒ¼ãƒ‰</th>
                            <th>æ•°é‡</th>
                        </tr>
                    </thead>
                    <tbody id="summaryBody"></tbody>
                </table>
                <button id="exportButton" class="btn btn-primary" style="margin-top:8px;">CSVãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
            </div>

                    
                    <div class="summary-grid" id="resultSummary">
                        <!-- çµæœã‚µãƒãƒªãƒ¼ -->
                    </div>

                    <!-- ãƒ‘ãƒ¬ãƒƒãƒˆçµåˆæ©Ÿèƒ½ -->
                    <div id="combineSection" class="hidden">
                        <div class="improvement-note" style="background-color: #fff3cd; border-color: #ffeaa7;">
                            <h3>ğŸ”„ ãƒ‘ãƒ¬ãƒƒãƒˆçµåˆæ©Ÿèƒ½</h3>
                            <p style="margin-bottom: 15px;">2ã¤ã®ãƒ‘ãƒ¬ãƒƒãƒˆã‚’é¸æŠã—ã¦ã€ã‚ˆã‚ŠåŠ¹ç‡çš„ãª1ã¤ã®ãƒ‘ãƒ¬ãƒƒãƒˆã«çµåˆã§ãã¾ã™ã€‚</p>
                            <div style="display: flex; gap: 15px; align-items: center; margin-bottom: 15px;">
                                <div>
                                    <label for="pallet1Select">ãƒ‘ãƒ¬ãƒƒãƒˆ1:</label>
                                    <select id="pallet1Select" class="form-input" style="width: 120px;">
                                        <option value="">é¸æŠ...</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="pallet2Select">ãƒ‘ãƒ¬ãƒƒãƒˆ2:</label>
                                    <select id="pallet2Select" class="form-input" style="width: 120px;">
                                        <option value="">é¸æŠ...</option>
                                    </select>
                                </div>
                                <button id="combineButton" class="btn btn-primary">ğŸ”„ ãƒ‘ãƒ¬ãƒƒãƒˆçµåˆ</button>
                                <button id="autoOptimizeButton" class="btn btn-success">âœ¨ è‡ªå‹•æœ€é©åŒ–</button>
                                <button id="analyzeButton" class="btn btn-secondary">ğŸ” è©³ç´°åˆ†æ</button>
                            </div>
                            <div id="combinePreview" style="font-size: 0.9rem; color: #666;"></div>
                        </div>
                    </div>

                    <div id="palletResults">
                        <!-- ãƒ‘ãƒ¬ãƒƒãƒˆçµæœ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ç®¡ç†
        let isDarkMode = false;

        function toggleDarkMode() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark-mode', isDarkMode);
            updateDarkModeIcon();
        }

        function updateDarkModeIcon() {
            const icon = document.querySelector('.dark-mode-icon');
            if (icon) {
                icon.textContent = isDarkMode ? 'â˜€ï¸' : 'ğŸŒ™';
            }
        }

        // åˆæœŸåŒ–æ™‚ã«ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã‚’ç„¡åŠ¹åŒ–ï¼ˆãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«ï¼‰
        function initializeDarkMode() {
            // ã‚·ã‚¹ãƒ†ãƒ ã®ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰è¨­å®šã‚’ç„¡è¦–ã—ã¦ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰ã‹ã‚‰é–‹å§‹
            document.body.classList.remove('dark-mode');
            isDarkMode = false;
            updateDarkModeIcon();
        }

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã®åˆæœŸåŒ–
        window.currentPallets = [];
        
        // é«˜ã•åˆ¶é™ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let maxHeightLimit = 158; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯158cmï¼ˆãƒ‘ãƒ¬ãƒƒãƒˆå°åº§14cmå«ã‚€ï¼‰
        
        // åˆæœŸãƒ‡ãƒ¼ã‚¿ï¼ˆæ‹¡å¼µã‚µãƒ³ãƒ—ãƒ«ï¼‰
        let cartonData = [
            { id: 1, code: 'SAMPLE A', qty: 362, weight: 6.70, l: 53.0, w: 38.5, h: 23.5 },
            { id: 2, code: 'SAMPLE B', qty: 42, weight: 7.60, l: 55.0, w: 40.0, h: 24.0 }
        ];

        const allPalletSizes = [
            { name: '1100Ã—1000', width: 110.0, depth: 100.0, description: 'æ¨™æº–ãƒ‘ãƒ¬ãƒƒãƒˆ' },
            { name: '1100Ã—1100', width: 110.0, depth: 110.0, description: 'æ­£æ–¹å½¢ãƒ‘ãƒ¬ãƒƒãƒˆ' },
            { name: '1200Ã—1000', width: 120.0, depth: 100.0, description: 'å¤§å‹ãƒ‘ãƒ¬ãƒƒãƒˆ' },
            { name: '1200Ã—1100', width: 120.0, depth: 110.0, description: 'ç‰¹å¤§ãƒ‘ãƒ¬ãƒƒãƒˆ' }
        ];

        let selectedPalletSizes = [...allPalletSizes]; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§å…¨é¸æŠ

        let editingId = null;
        let nextId = 7;

        // Helper function for safe division
        function safeDivide(a, b, defaultValue = 0) {
            return b !== 0 ? a / b : defaultValue;
        }

        // === é«˜ã•åˆ¶é™è¨­å®šæ©Ÿèƒ½ ===
        function setHeightLimit(height) {
            const input = document.getElementById('heightLimitInput');
            const display = document.getElementById('heightLimitDisplay');
            const warning = document.getElementById('heightWarning');
            
            // å€¤ã‚’æ›´æ–°
            input.value = height;
            maxHeightLimit = height;
            display.textContent = height;
            
            // ãƒ—ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã®çŠ¶æ…‹æ›´æ–°
            document.querySelectorAll('.height-preset-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            event.target.classList.add('active');
            
            // è­¦å‘Šè¡¨ç¤ºã®åˆ¤å®š
            if (height > 180) {
                warning.classList.remove('hidden');
            } else {
                warning.classList.add('hidden');
            }
            
            console.log(`é«˜ã•åˆ¶é™ã‚’${height}cmã«è¨­å®šã—ã¾ã—ãŸ`);
            
            // æ—¢ã«è¨ˆç®—çµæœãŒã‚ã‚‹å ´åˆã¯å½±éŸ¿ã‚’é€šçŸ¥
            if (window.currentPallets && window.currentPallets.length > 0) {
                const affectedPallets = window.currentPallets.filter(pallet => pallet.height > height);
                if (affectedPallets.length > 0) {
                    const alertDiv = document.createElement('div');
                    alertDiv.className = 'alert alert-warning';
                    alertDiv.innerHTML = `âš ï¸ é«˜ã•åˆ¶é™å¤‰æ›´: ${affectedPallets.length}æšã®ãƒ‘ãƒ¬ãƒƒãƒˆãŒæ–°ã—ã„åˆ¶é™(${height}cm)ã‚’è¶…éã—ã¦ã„ã¾ã™ã€‚å†è¨ˆç®—ã‚’æ¨å¥¨ã—ã¾ã™ã€‚`;
                    document.getElementById('errors').appendChild(alertDiv);
                }
            }
        }

        function updateHeightLimitFromInput() {
            const input = document.getElementById('heightLimitInput');
            const display = document.getElementById('heightLimitDisplay');
            const warning = document.getElementById('heightWarning');
            
            let height = parseInt(input.value);
            
            // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
            if (isNaN(height) || height < 50) {
                height = 50;
                input.value = 50;
            } else if (height > 300) {
                height = 300;
                input.value = 300;
            }
            
            maxHeightLimit = height;
            display.textContent = height;
            
            // ãƒ—ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã®çŠ¶æ…‹æ›´æ–°ï¼ˆè©²å½“ã™ã‚‹å€¤ã®å ´åˆï¼‰
            document.querySelectorAll('.height-preset-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            const matchingPreset = document.querySelector(`[onclick="setHeightLimit(${height})"]`);
            if (matchingPreset) {
                matchingPreset.classList.add('active');
            }
            
            // è­¦å‘Šè¡¨ç¤ºã®åˆ¤å®š
            if (height > 180) {
                warning.classList.remove('hidden');
            } else {
                warning.classList.add('hidden');
            }
            
            console.log(`é«˜ã•åˆ¶é™ã‚’${height}cmã«æ›´æ–°ã—ã¾ã—ãŸ`);
        }

        // é«˜ã•åˆ¶é™ã‚’å–å¾—ã™ã‚‹é–¢æ•°ï¼ˆã‚«ãƒ¼ãƒˆãƒ³é…ç½®å¯èƒ½é«˜ã•ï¼‰
        function getMaxCartonHeight() {
            return maxHeightLimit - 14; // ãƒ‘ãƒ¬ãƒƒãƒˆå°åº§14cmã‚’é™¤ã„ãŸã‚«ãƒ¼ãƒˆãƒ³é…ç½®å¯èƒ½é«˜ã•
        }

        // é«˜ã•åˆ¶é™ã‚’å–å¾—ã™ã‚‹é–¢æ•°ï¼ˆç·é«˜ã•ï¼‰
        function getMaxTotalHeight() {
            return maxHeightLimit;
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializeDarkMode(); // ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰åˆæœŸåŒ–ã‚’è¿½åŠ 
            updateTable();
            updateSummary();
            setupEventListeners();
            initializePalletSelection();
            initializeHeightLimit();
        });

        // ä»¥ä¸‹ã€æ—¢å­˜ã®JavaScripté–¢æ•°ã‚’å…¨ã¦å«ã‚ã‚‹ï¼ˆçœç•¥ã›ãšã«å…¨éƒ¨ã‚³ãƒ”ãƒ¼ï¼‰
        // [å…ƒã®index.htmlã‹ã‚‰å…¨ã¦ã®JavaScripté–¢æ•°ã‚’ã“ã“ã«ã‚³ãƒ”ãƒ¼ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™]
        // ã‚¹ãƒšãƒ¼ã‚¹ã®éƒ½åˆä¸Šã€ã“ã“ã§ã¯ä¸»è¦ãªé–¢æ•°ã®ã¿ç¤ºã—ã¦ã„ã¾ã™

        function initializeHeightLimit() {
            const input = document.getElementById('heightLimitInput');
            if (input) {
                input.addEventListener('input', updateHeightLimitFromInput);
                input.addEventListener('blur', updateHeightLimitFromInput);
            }
        }

        function setupEventListeners() {
            document.getElementById('addButton').addEventListener('click', toggleAddForm);
            document.getElementById('saveAddButton').addEventListener('click', addCarton);
            document.getElementById('cancelAddButton').addEventListener('click', cancelAdd);
            document.getElementById('calculateButton').addEventListener('click', calculateImprovedPalletization);
            
            // ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ©Ÿèƒ½
            document.getElementById('downloadTemplateButton').addEventListener('click', downloadCSVTemplate);
            document.getElementById('importButton').addEventListener('click', toggleImportArea);
            document.getElementById('executeImportButton').addEventListener('click', executeImport);
            document.getElementById('cancelImportButton').addEventListener('click', cancelImport);
            
            // ä¸€æ‹¬å‰Šé™¤æ©Ÿèƒ½
            document.getElementById('clearAllButton').addEventListener('click', clearAllCartons);
            
            // Exportæ©Ÿèƒ½
            const exportBtn = document.getElementById('exportButton');
            if (exportBtn) exportBtn.addEventListener('click', exportSummaryCsv);
            
            // ãƒ‘ãƒ¬ãƒƒãƒˆçµåˆæ©Ÿèƒ½
            document.getElementById('combineButton').addEventListener('click', combinePallets);
            document.getElementById('autoOptimizeButton').addEventListener('click', autoOptimizePallets);
            document.getElementById('analyzeButton').addEventListener('click', analyzeSelectedPallets);
            document.getElementById('pallet1Select').addEventListener('change', updateCombinePreview);
            document.getElementById('pallet2Select').addEventListener('change', updateCombinePreview);

            // ãƒ‘ãƒ¬ãƒƒãƒˆé¸æŠæ©Ÿèƒ½
            document.getElementById('selectAllPallets').addEventListener('click', selectAllPallets);
            document.getElementById('deselectAllPallets').addEventListener('click', deselectAllPallets);
        }

        // [ã“ã“ã«å…ƒã®JavaScriptã®å…¨ã¦ã®é–¢æ•°ã‚’è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™]
        // å®Œå…¨ãªJavaScriptã‚³ãƒ¼ãƒ‰ã¯å…ƒã®ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰å…¨ã¦ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„
        
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã¨ã—ã¦å®šç¾©
        window.showDiagramView = showDiagramView;
        window.scrollToPallet = scrollToPallet;
        window.setHeightLimit = setHeightLimit;
    </script>
</body>
</html>