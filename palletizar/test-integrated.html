<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çµ±åˆé–¢æ•°ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .warning { background-color: #fff3cd; border-color: #ffeaa7; }
        button { padding: 10px 15px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; }
        .btn-primary { background-color: #007bff; color: white; }
        .btn-success { background-color: #28a745; color: white; }
        .btn-warning { background-color: #ffc107; color: black; }
        .function-list { font-family: monospace; background-color: #f8f9fa; padding: 10px; border-radius: 4px; }
        .instructions { background-color: #e7f3ff; border: 1px solid #b3d9ff; padding: 15px; border-radius: 8px; }
    </style>
</head>
<body>
    <h1>ğŸ” çµ±åˆé–¢æ•°ãƒ†ã‚¹ãƒˆ</h1>
    
    <div class="instructions">
        <h3>ğŸ“‹ ä½¿ç”¨æ–¹æ³•</h3>
        <p>ã“ã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ãƒ¡ã‚¤ãƒ³ã®ãƒ‘ãƒ¬ã‚¿ã‚¤ã‚ºã‚¢ãƒ—ãƒªï¼ˆindex.htmlï¼‰å†…ã§å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p>
        <ol>
            <li>ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªï¼ˆindex.htmlï¼‰ã‚’é–‹ã</li>
            <li>ãƒ–ãƒ©ã‚¦ã‚¶ã®é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ï¼ˆF12ï¼‰ã‚’é–‹ã</li>
            <li>ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚¿ãƒ–ã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œï¼š</li>
            <li><code>fetch('test-integrated.html').then(r => r.text()).then(html => document.body.insertAdjacentHTML('beforeend', html))</code></li>
        </ol>
    </div>
    
    <div class="test-section">
        <h3>ğŸ“‹ é–¢æ•°å­˜åœ¨ãƒã‚§ãƒƒã‚¯</h3>
        <p>ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ã§åˆ©ç”¨å¯èƒ½ãªé–¢æ•°ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚</p>
        <button onclick="checkAvailableFunctions()" class="btn-primary">é–¢æ•°ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ</button>
        <div id="functionCheckResult"></div>
    </div>
    
    <div class="test-section">
        <h3>ğŸš€ ãƒ‘ãƒ¬ãƒƒãƒˆçµåˆæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h3>
        <p>ãƒ‘ãƒ¬ãƒƒãƒˆçµåˆé–¢é€£ã®é–¢æ•°ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚</p>
        <button onclick="testPalletCombination()" class="btn-success">ãƒ‘ãƒ¬ãƒƒãƒˆçµåˆãƒ†ã‚¹ãƒˆ</button>
        <div id="combinationTestResult"></div>
    </div>
    
    <div class="test-section">
        <h3>âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h3>
        <p>ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚</p>
        <button onclick="testPerformanceFunctions()" class="btn-warning">ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ</button>
        <div id="performanceTestResult"></div>
    </div>

    <script>
        // åˆ©ç”¨å¯èƒ½ãªé–¢æ•°ã®ãƒã‚§ãƒƒã‚¯
        function checkAvailableFunctions() {
            const result = document.getElementById('functionCheckResult');
            
            const requiredFunctions = [
                'updatePalletSelectors',
                'updateCombinePreview', 
                'combinePallets',
                'autoOptimizePallets',
                'analyzeSelectedPallets',
                'showDiagramView',
                'scrollToPallet',
                'setHeightLimit',
                'saveEdit',
                'cancelEdit',
                'startEdit',
                'deleteCarton'
            ];
            
            const missingFunctions = [];
            const availableFunctions = [];
            
            requiredFunctions.forEach(funcName => {
                if (typeof window[funcName] === 'function') {
                    availableFunctions.push(funcName);
                } else {
                    missingFunctions.push(funcName);
                }
            });
            
            if (missingFunctions.length === 0) {
                result.innerHTML = `
                    <div class="success">
                        âœ… ã™ã¹ã¦ã®å¿…é ˆé–¢æ•°ãŒåˆ©ç”¨å¯èƒ½ã§ã™ï¼<br>
                        åˆ©ç”¨å¯èƒ½ãªé–¢æ•°æ•°: ${availableFunctions.length}å€‹
                    </div>
                `;
            } else {
                result.innerHTML = `
                    <div class="error">
                        âŒ ä¸è¶³ã—ã¦ã„ã‚‹é–¢æ•°ãŒã‚ã‚Šã¾ã™<br>
                        ä¸è¶³é–¢æ•°æ•°: ${missingFunctions.length}å€‹<br>
                        ä¸è¶³é–¢æ•°: <span class="function-list">${missingFunctions.join(', ')}</span>
                    </div>
                `;
            }
        }
        
        // ãƒ‘ãƒ¬ãƒƒãƒˆçµåˆæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
        function testPalletCombination() {
            const result = document.getElementById('combinationTestResult');
            
            try {
                // ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ
                if (!window.currentPallets) {
                    window.currentPallets = [
                        {
                            palletSize: { name: '1100Ã—1000', width: 110, depth: 100 },
                            cartons: [{ code: 'TEST1', l: 50, w: 30, h: 20 }],
                            layers: [{ height: 20, cartons: [{ code: 'TEST1' }] }],
                            height: 20,
                            totalWeight: 10
                        },
                        {
                            palletSize: { name: '1100Ã—1000', width: 110, depth: 100 },
                            cartons: [{ code: 'TEST2', l: 40, w: 25, h: 15 }],
                            layers: [{ height: 15, cartons: [{ code: 'TEST2' }] }],
                            height: 15,
                            totalWeight: 8
                        }
                    ];
                }
                
                // é–¢æ•°ã®å­˜åœ¨ãƒã‚§ãƒƒã‚¯
                const functions = ['updatePalletSelectors', 'updateCombinePreview', 'combinePallets'];
                const missingFuncs = functions.filter(f => typeof window[f] !== 'function');
                
                if (missingFuncs.length > 0) {
                    result.innerHTML = `
                        <div class="error">
                            âŒ ãƒ‘ãƒ¬ãƒƒãƒˆçµåˆæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆå¤±æ•—<br>
                            ä¸è¶³ã—ã¦ã„ã‚‹é–¢æ•°: ${missingFuncs.join(', ')}<br>
                            <br>
                            <strong>è§£æ±ºæ–¹æ³•:</strong><br>
                            1. ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªï¼ˆindex.htmlï¼‰ã‚’é–‹ã<br>
                            2. ãƒ‘ãƒ¬ã‚¿ã‚¤ã‚ºè¨ˆç®—ã‚’å®Ÿè¡Œã—ã¦ãƒ‘ãƒ¬ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ<br>
                            3. ã“ã®ãƒ†ã‚¹ãƒˆã‚’å†å®Ÿè¡Œ
                        </div>
                    `;
                    return;
                }
                
                result.innerHTML = `
                    <div class="success">
                        âœ… ãƒ‘ãƒ¬ãƒƒãƒˆçµåˆæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆæˆåŠŸï¼<br>
                        ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ä½œæˆå®Œäº†<br>
                        ãƒ‘ãƒ¬ãƒƒãƒˆæ•°: ${window.currentPallets.length}æš<br>
                        åˆ©ç”¨å¯èƒ½ãªé–¢æ•°: ${functions.join(', ')}
                    </div>
                `;
                
            } catch (error) {
                result.innerHTML = `
                    <div class="error">
                        âŒ ãƒ‘ãƒ¬ãƒƒãƒˆçµåˆæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆå¤±æ•—<br>
                        ã‚¨ãƒ©ãƒ¼: ${error.message}
                    </div>
                `;
            }
        }
        
        // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
        function testPerformanceFunctions() {
            const result = document.getElementById('performanceTestResult');
            
            try {
                // åŸºæœ¬çš„ãªãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹é–¢æ•°ã®ãƒã‚§ãƒƒã‚¯
                const basicFunctions = ['performance', 'performance.now'];
                const missingBasic = basicFunctions.filter(f => {
                    try {
                        return eval(f) === undefined;
                    } catch {
                        return true;
                    }
                });
                
                if (missingBasic.length > 0) {
                    result.innerHTML = `
                        <div class="error">
                            âŒ åŸºæœ¬çš„ãªãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹APIãŒåˆ©ç”¨ã§ãã¾ã›ã‚“<br>
                            ä¸è¶³: ${missingBasic.join(', ')}
                        </div>
                    `;
                    return;
                }
                
                // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®šãƒ†ã‚¹ãƒˆ
                const startTime = performance.now();
                let sum = 0;
                for (let i = 0; i < 100000; i++) {
                    sum += Math.sqrt(i);
                }
                const endTime = performance.now();
                const duration = (endTime - startTime) / 1000;
                
                result.innerHTML = `
                    <div class="success">
                        âœ… ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆæˆåŠŸï¼<br>
                        åŸºæœ¬çš„ãªãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹API: åˆ©ç”¨å¯èƒ½<br>
                        ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®šãƒ†ã‚¹ãƒˆ: ${duration.toFixed(3)}ç§’<br>
                        è¨ˆç®—çµæœ: ${sum.toFixed(2)}
                    </div>
                `;
                
            } catch (error) {
                result.innerHTML = `
                    <div class="error">
                        âŒ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆå¤±æ•—<br>
                        ã‚¨ãƒ©ãƒ¼: ${error.message}
                    </div>
                `;
            }
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«è‡ªå‹•ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        window.addEventListener('load', () => {
            console.log('ğŸ” çµ±åˆé–¢æ•°ãƒ†ã‚¹ãƒˆé–‹å§‹');
            setTimeout(() => {
                checkAvailableFunctions();
                testPalletCombination();
                testPerformanceFunctions();
            }, 1000);
        });
        
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã¨ã—ã¦å…¬é–‹
        window.testFunctions = {
            checkAvailableFunctions,
            testPalletCombination,
            testPerformanceFunctions
        };
        
        console.log('ğŸ” çµ±åˆé–¢æ•°ãƒ†ã‚¹ãƒˆãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸã€‚window.testFunctions ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚');
    </script>
</body>
</html>