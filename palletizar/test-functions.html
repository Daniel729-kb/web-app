<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é–¢æ•°å­˜åœ¨ãƒã‚§ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .warning { background-color: #fff3cd; border-color: #ffeaa7; }
        button { padding: 10px 15px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; }
        .btn-primary { background-color: #007bff; color: white; }
        .btn-success { background-color: #28a745; color: white; }
        .btn-warning { background-color: #ffc107; color: black; }
        .function-list { font-family: monospace; background-color: #f8f9fa; padding: 10px; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>ğŸ” é–¢æ•°å­˜åœ¨ãƒã‚§ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ</h1>
    
    <div class="test-section">
        <h3>ğŸ“‹ å¿…é ˆé–¢æ•°ã®å­˜åœ¨ãƒã‚§ãƒƒã‚¯</h3>
        <p>ãƒ‘ãƒ¬ã‚¿ã‚¤ã‚ºã‚¢ãƒ—ãƒªã«å¿…è¦ãªé–¢æ•°ãŒã™ã¹ã¦å®šç¾©ã•ã‚Œã¦ã„ã‚‹ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚</p>
        <button onclick="checkRequiredFunctions()" class="btn-primary">é–¢æ•°å­˜åœ¨ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ</button>
        <div id="functionCheckResult"></div>
    </div>
    
    <div class="test-section">
        <h3>ğŸš€ ãƒ‘ãƒ¬ãƒƒãƒˆçµåˆæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h3>
        <p>ãƒ‘ãƒ¬ãƒƒãƒˆçµåˆé–¢é€£ã®é–¢æ•°ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã‹ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚</p>
        <button onclick="testPalletCombination()" class="btn-success">ãƒ‘ãƒ¬ãƒƒãƒˆçµåˆæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</button>
        <div id="combinationTestResult"></div>
    </div>
    
    <div class="test-section">
        <h3>âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h3>
        <p>ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–æ©Ÿèƒ½ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã‹ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚</p>
        <button onclick="testPerformanceFunctions()" class="btn-warning">ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</button>
        <div id="performanceTestResult"></div>
    </div>

    <script>
        // å¿…é ˆé–¢æ•°ã®å­˜åœ¨ãƒã‚§ãƒƒã‚¯
        function checkRequiredFunctions() {
            const result = document.getElementById('functionCheckResult');
            
            const requiredFunctions = [
                'updatePalletSelectors',
                'updateCombinePreview', 
                'combinePallets',
                'autoOptimizePallets',
                'analyzeSelectedPallets',
                'showDiagramView',
                'scrollToPallet',
                'setHeightLimit',
                'saveEdit',
                'cancelEdit',
                'startEdit',
                'deleteCarton',
                'getMemoryUsage',
                'checkMemoryLimit',
                'validateCartonData',
                'updatePerformanceMetrics'
            ];
            
            const missingFunctions = [];
            const availableFunctions = [];
            
            requiredFunctions.forEach(funcName => {
                if (typeof window[funcName] === 'function') {
                    availableFunctions.push(funcName);
                } else {
                    missingFunctions.push(funcName);
                }
            });
            
            if (missingFunctions.length === 0) {
                result.innerHTML = `
                    <div class="success">
                        âœ… ã™ã¹ã¦ã®å¿…é ˆé–¢æ•°ãŒåˆ©ç”¨å¯èƒ½ã§ã™ï¼<br>
                        åˆ©ç”¨å¯èƒ½ãªé–¢æ•°æ•°: ${availableFunctions.length}å€‹
                    </div>
                `;
            } else {
                result.innerHTML = `
                    <div class="error">
                        âŒ ä¸è¶³ã—ã¦ã„ã‚‹é–¢æ•°ãŒã‚ã‚Šã¾ã™<br>
                        ä¸è¶³é–¢æ•°æ•°: ${missingFunctions.length}å€‹<br>
                        ä¸è¶³é–¢æ•°: <span class="function-list">${missingFunctions.join(', ')}</span>
                    </div>
                `;
            }
        }
        
        // ãƒ‘ãƒ¬ãƒƒãƒˆçµåˆæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
        function testPalletCombination() {
            const result = document.getElementById('combinationTestResult');
            
            try {
                // ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ
                window.currentPallets = [
                    {
                        palletSize: { name: '1100Ã—1000', width: 110, depth: 100 },
                        cartons: [{ code: 'TEST1', l: 50, w: 30, h: 20 }],
                        layers: [{ height: 20, cartons: [{ code: 'TEST1' }] }],
                        height: 20,
                        totalWeight: 10
                    },
                    {
                        palletSize: { name: '1100Ã—1000', width: 110, depth: 100 },
                        cartons: [{ code: 'TEST2', l: 40, w: 25, h: 15 }],
                        layers: [{ height: 15, cartons: [{ code: 'TEST2' }] }],
                        height: 15,
                        totalWeight: 8
                    }
                ];
                
                // é–¢æ•°ã®å­˜åœ¨ãƒã‚§ãƒƒã‚¯
                const functions = ['updatePalletSelectors', 'updateCombinePreview', 'combinePallets'];
                const missingFuncs = functions.filter(f => typeof window[f] !== 'function');
                
                if (missingFuncs.length > 0) {
                    result.innerHTML = `
                        <div class="error">
                            âŒ ãƒ‘ãƒ¬ãƒƒãƒˆçµåˆæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆå¤±æ•—<br>
                            ä¸è¶³ã—ã¦ã„ã‚‹é–¢æ•°: ${missingFuncs.join(', ')}
                        </div>
                    `;
                    return;
                }
                
                result.innerHTML = `
                    <div class="success">
                        âœ… ãƒ‘ãƒ¬ãƒƒãƒˆçµåˆæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆæˆåŠŸï¼<br>
                        ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ä½œæˆå®Œäº†<br>
                        ãƒ‘ãƒ¬ãƒƒãƒˆæ•°: ${window.currentPallets.length}æš<br>
                        åˆ©ç”¨å¯èƒ½ãªé–¢æ•°: ${functions.join(', ')}
                    </div>
                `;
                
            } catch (error) {
                result.innerHTML = `
                    <div class="error">
                        âŒ ãƒ‘ãƒ¬ãƒƒãƒˆçµåˆæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆå¤±æ•—<br>
                        ã‚¨ãƒ©ãƒ¼: ${error.message}
                    </div>
                `;
            }
        }
        
        // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
        function testPerformanceFunctions() {
            const result = document.getElementById('performanceTestResult');
            
            try {
                const functions = ['getMemoryUsage', 'checkMemoryLimit', 'updatePerformanceMetrics'];
                const missingFuncs = functions.filter(f => typeof window[f] !== 'function');
                
                if (missingFuncs.length > 0) {
                    result.innerHTML = `
                        <div class="error">
                            âŒ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆå¤±æ•—<br>
                            ä¸è¶³ã—ã¦ã„ã‚‹é–¢æ•°: ${missingFuncs.join(', ')}
                        </div>
                    `;
                    return;
                }
                
                // ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ãƒã‚§ãƒƒã‚¯
                const memory = getMemoryUsage();
                const memoryStatus = memory ? 'âœ… åˆ©ç”¨å¯èƒ½' : 'âš ï¸ éå¯¾å¿œ';
                
                result.innerHTML = `
                    <div class="success">
                        âœ… ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆæˆåŠŸï¼<br>
                        ãƒ¡ãƒ¢ãƒªç›£è¦–: ${memoryStatus}<br>
                        åˆ©ç”¨å¯èƒ½ãªé–¢æ•°: ${functions.join(', ')}<br>
                        ${memory ? `ç¾åœ¨ã®ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: ${memory.used}MB (${memory.percentage}%)` : ''}
                    </div>
                `;
                
            } catch (error) {
                result.innerHTML = `
                    <div class="error">
                        âŒ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆå¤±æ•—<br>
                        ã‚¨ãƒ©ãƒ¼: ${error.message}
                    </div>
                `;
            }
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«è‡ªå‹•ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        window.addEventListener('load', () => {
            console.log('ğŸ” é–¢æ•°å­˜åœ¨ãƒã‚§ãƒƒã‚¯ãƒ†ã‚¹ãƒˆé–‹å§‹');
            checkRequiredFunctions();
            testPalletCombination();
            testPerformanceFunctions();
        });
    </script>
</body>
</html>