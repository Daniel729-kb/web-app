<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‰©æµãƒãƒƒãƒ—è‡ªå‹•ä½œæˆ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            width: 98%;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            display: flex;
            min-height: 75vh;
        }

        .input-panel {
            width: 380px;
            min-width: 380px;
            background: #f8fafc;
            padding: 30px;
            border-right: 1px solid #e2e8f0;
            overflow-y: auto;
            max-height: 85vh;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #374151;
            font-size: 13px;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 13px;
            transition: all 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .form-row {
            display: flex;
            gap: 10px;
        }

        .form-row .form-group {
            flex: 1;
        }

        .section-title {
            font-size: 15px;
            font-weight: 700;
            color: #1f2937;
            margin: 25px 0 12px 0;
            padding-bottom: 6px;
            border-bottom: 2px solid #4f46e5;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .add-btn, .remove-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .add-btn {
            background: #10b981;
            color: white;
        }

        .add-btn:hover {
            background: #059669;
        }

        .remove-btn {
            background: #ef4444;
            color: white;
            margin-left: 8px;
        }

        .remove-btn:hover {
            background: #dc2626;
        }

        .location-item, .transport-item {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            position: relative;
        }

        .location-item h4, .transport-item h4 {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .map-panel {
            flex: 1;
            padding: 20px;
            background: #ffffff;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            min-width: 0;
        }

        .map-controls {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        .export-btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
        }

        .custom-textbox {
            position: absolute;
            background: #fff;
            border: 2px solid #4f46e5;
            border-radius: 8px;
            padding: 10px;
            font-size: 14px;
            min-width: 100px;
            min-height: 40px;
            resize: both;
            overflow: auto;
            cursor: move;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .custom-textbox:focus {
            outline: none;
            border-color: #7c3aed;
        }

        .custom-textbox.editing {
            cursor: text;
        }

        .delete-textbox {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            cursor: pointer;
            display: none;
        }

        .custom-textbox:hover .delete-textbox {
            display: block;
        }

        .draggable {
            cursor: move !important;
        }

        .dragging {
            opacity: 0.8;
            transform: scale(1.05);
        }

        .edit-mode .location-box,
        .edit-mode .flow-arrow {
            cursor: move;
            border: 2px dashed #7c3aed;
        }

        .edit-mode .location-box:hover,
        .edit-mode .flow-arrow:hover {
            background-color: rgba(124, 58, 237, 0.1);
        }

        .logistics-map {
            display: flex;
            align-items: flex-start;
            justify-content: center;
            min-width: 800px;
            width: 100%;
            min-height: 500px;
            position: relative;
            margin: 0 auto;
            background: #ffffff;
            overflow: visible;
            gap: 20px;
            overflow-x: auto;
            padding: 30px 15px;
        }

        .location-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            gap: 8px;
            min-width: 200px;
            min-height: 400px;
        }

        .transport-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            gap: 8px;
            min-width: 130px;
            min-height: 400px;
            margin-top: 0;
        }

        .location-box {
            background: white;
            border: 3px solid #e5e7eb;
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            width: 180px;
            height: 200px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
            transition: all 0.3s ease;
            position: relative;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .location-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.18);
        }

        .location-box.domestic {
            border-color: #10b981;
            background: linear-gradient(135deg, #ecfdf5, #f0fdf4);
        }

        .location-box.overseas {
            border-color: #f59e0b;
            background: linear-gradient(135deg, #fffbeb, #fefce8);
        }

        .location-box.bonded {
            border: 3px solid #dc2626;
            background: linear-gradient(135deg, #fef2f2, #fef2f2);
            position: relative;
        }

        .location-box.bonded::before {
            content: '';
            position: absolute;
            top: -8px;
            left: -8px;
            right: -8px;
            bottom: -8px;
            border: 2px dashed #dc2626;
            border-radius: 16px;
            z-index: -1;
        }

        .location-box.bonded::after {
            content: 'ä¿ç¨å€‰åº«';
            position: absolute;
            top: -18px;
            right: -10px;
            background: #dc2626;
            color: white;
            padding: 3px 6px;
            border-radius: 3px;
            font-size: 9px;
            font-weight: bold;
            z-index: 10;
        }

        .location-box.existing {
            border: 3px solid #2563eb;
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
            position: relative;
        }

        .location-box.existing::after {
            content: 'âœ“ æ—¢å­˜';
            position: absolute;
            top: -12px;
            left: -10px;
            background: #2563eb;
            color: white;
            padding: 3px 6px;
            border-radius: 3px;
            font-size: 9px;
            font-weight: bold;
            z-index: 10;
        }

        .location-box.new {
            border: 3px solid #dc2626;
            background: linear-gradient(135deg, #fef2f2, #fee2e2);
            position: relative;
        }

        .location-box.new::after {
            content: 'ğŸ†• æ–°è¨­';
            position: absolute;
            top: -12px;
            left: -10px;
            background: #dc2626;
            color: white;
            padding: 3px 6px;
            border-radius: 3px;
            font-size: 9px;
            font-weight: bold;
            z-index: 10;
        }

        .location-box.bonded.existing::after,
        .location-box.bonded.new::after {
            top: -12px;
            left: -10px;
        }

        .temp-control-info {
            margin-top: 12px;
            padding: 10px;
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            border: 2px solid #0ea5e9;
            border-radius: 8px;
            font-size: 10px;
        }

        .temp-control-title {
            font-weight: 600;
            color: #0369a1;
            margin-bottom: 6px;
            text-align: center;
            font-size: 11px;
        }

        .temp-humidity-row {
            display: flex;
            justify-content: space-between;
            gap: 8px;
        }

        .temp-item, .humidity-item {
            flex: 1;
            text-align: center;
        }

        .temp-label, .humidity-label {
            font-size: 8px;
            color: #64748b;
            margin-bottom: 2px;
        }

        .temp-value, .humidity-value {
            font-weight: 600;
            color: #0f172a;
            font-size: 10px;
        }

        .location-title {
            font-size: 13px;
            font-weight: 600;
            color: #6b7280;
            margin-bottom: 8px;
        }

        .location-name {
            font-size: 16px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 8px;
            line-height: 1.2;
        }

        .location-type {
            font-size: 11px;
            padding: 4px 8px;
            border-radius: 15px;
            font-weight: 600;
        }

        .domestic-tag {
            background: #10b981;
            color: white;
        }

        .overseas-tag {
            background: #f59e0b;
            color: white;
        }

        .flow-arrow {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            margin: 0;
            flex-shrink: 0;
        }

        .arrow {
            font-size: 24px;
            color: #4f46e5;
            margin: 10px 0;
            order: 2;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .arrow.existing {
            color: #2563eb;
        }

        .arrow.new {
            color: #dc2626;
        }

        .arrow::before {
            content: "â¡";
        }

        .flow-line {
            width: 80px;
            height: 4px;
            background: linear-gradient(90deg, #4f46e5, #7c3aed);
            border-radius: 2px;
            order: 2;
        }

        .flow-line.existing {
            background: linear-gradient(90deg, #2563eb, #3b82f6);
        }

        .flow-line.new {
            background: linear-gradient(90deg, #dc2626, #ef4444);
        }

        .transport-info {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            border: 2px solid #0ea5e9;
            border-radius: 12px;
            padding: 8px;
            text-align: center;
            margin: 0;
            box-shadow: 0 4px 15px rgba(14, 165, 233, 0.2);
            position: relative;
            width: 120px;
            height: 200px;
            order: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            overflow: visible;
        }

        .transport-arrow-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 3px 0;
        }

        .transport-arrow {
            font-size: 16px;
            color: #4f46e5;
        }

        .transport-arrow.existing {
            color: #2563eb;
        }

        .transport-arrow.new {
            color: #dc2626;
        }

        .transport-info.existing {
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
            border: 2px solid #2563eb;
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.2);
        }

        .transport-info.existing::before {
            content: 'æ—¢å­˜';
            position: absolute;
            top: -8px;
            right: -8px;
            background: #2563eb;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 9px;
            font-weight: bold;
            white-space: nowrap;
            z-index: 10;
        }

        .transport-info.new {
            background: linear-gradient(135deg, #fef2f2, #fee2e2);
            border: 2px solid #dc2626;
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.2);
        }

        .transport-info.new::before {
            content: 'æ–°è¨­';
            position: absolute;
            top: -8px;
            right: -8px;
            background: #dc2626;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 9px;
            font-weight: bold;
            white-space: nowrap;
            z-index: 10;
        }

        .transport-details {
            margin-top: 5px;
            padding-top: 5px;
            border-top: 1px solid rgba(14, 165, 233, 0.3);
            flex: 1;
            overflow: visible;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
        }

        .transport-detail-item {
            display: flex;
            justify-content: space-between;
            margin: 2px 0;
            font-size: 9px;
            line-height: 1.2;
        }

        .transport-detail-label {
            color: #6b7280;
            font-weight: 600;
            flex-shrink: 0;
        }

        .transport-detail-value {
            color: #1f2937;
            font-weight: 700;
            text-align: right;
            word-break: break-word;
            margin-left: 4px;
        }

        .transport-icon {
            font-size: 16px;
            margin-bottom: 3px;
        }

        .truck { background: linear-gradient(135deg, #fef3c7, #fde68a); border-color: #f59e0b; }
        .ship { background: linear-gradient(135deg, #dbeafe, #bfdbfe); border-color: #3b82f6; }
        .air { background: linear-gradient(135deg, #f3e8ff, #e9d5ff); border-color: #8b5cf6; }
        .rail { background: linear-gradient(135deg, #f0fdf4, #dcfce7); border-color: #22c55e; }

        .flow-label {
            font-size: 10px;
            color: #6b7280;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .flow-value {
            font-size: 13px;
            color: #1f2937;
            font-weight: 700;
            margin-bottom: 3px;
        }

        .generate-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(79, 70, 229, 0.3);
        }

        .warehouse-options {
            margin-top: 10px;
            padding: 12px;
            background: #f3f4f6;
            border-radius: 8px;
            border-left: 4px solid #f59e0b;
        }

        .temp-control-options {
            margin-top: 10px;
            padding: 12px;
            background: #f0f9ff;
            border-radius: 8px;
            border-left: 4px solid #0ea5e9;
        }

        .temp-control-row {
            display: flex;
            gap: 10px;
        }

        .temp-control-row .form-group {
            flex: 1;
        }

        /* ç©ºã®ã‚¹ãƒšãƒ¼ã‚µãƒ¼è¦ç´  */
        .transport-spacer {
            width: 120px;
            height: 200px;
            margin: 0;
            visibility: hidden;
        }

        @media (min-width: 1201px) {
            .main-content {
                flex-direction: row !important;
            }
            
            .logistics-map {
                flex-direction: row !important;
                min-width: 700px;
                justify-content: flex-start;
            }
            
            .input-panel {
                width: 380px !important;
                min-width: 380px !important;
            }
        }

        @media (max-width: 1200px) {
            .container {
                margin: 10px;
                width: calc(100% - 20px);
            }
            
            .main-content {
                flex-direction: column;
            }
            
            .input-panel {
                width: 100%;
                max-height: none;
                min-width: auto;
            }
            
            .logistics-map {
                flex-direction: column;
                min-height: auto;
                gap: 30px;
                min-width: auto;
                padding: 30px 15px;
            }
            
            .location-group, .transport-group {
                width: 100%;
                min-height: auto;
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: center;
                gap: 20px;
            }
            
            .location-box {
                width: 160px;
                min-height: 120px;
                height: auto;
            }
            
            .transport-info {
                width: 120px;
                min-height: 140px;
                height: auto;
            }
            
            .transport-arrow-container {
                flex-direction: column;
                gap: 4px;
            }
            
            .transport-arrow {
                transform: rotate(90deg);
            }
            
            .flow-arrow {
                margin: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ç‰©æµãƒãƒƒãƒ—è‡ªå‹•ä½œæˆ</h1>
            <p>èª¿é”å…ˆã‹ã‚‰ç´å…¥å…ˆã¾ã§ã®ç‰©æµãƒ•ãƒ­ãƒ¼ã‚’å¯è¦–åŒ–</p>
        </div>
        
        <div class="main-content">
            <div class="input-panel">
                <div class="section-title">
                    èª¿é”å…ˆæƒ…å ±
                    <button class="add-btn" onclick="addSupplier()">+ è¿½åŠ </button>
                </div>
                <div id="suppliers-container">
                    <div class="location-item" data-index="0">
                        <h4>èª¿é”å…ˆ 1
                            <button class="remove-btn" onclick="removeSupplier(0)" style="display: none;">å‰Šé™¤</button>
                        </h4>
                        <div class="form-group">
                            <label>èª¿é”å…ˆå</label>
                            <input type="text" id="supplier-name-0" placeholder="ä¾‹ï¼šABCå•†äº‹" value="ä¸Šæµ·é›»å­éƒ¨å“">
                        </div>
                        <div class="form-group">
                            <label>å›½å†…/æµ·å¤–</label>
                            <select id="supplier-location-0">
                                <option value="domestic">å›½å†…</option>
                                <option value="overseas" selected>æµ·å¤–</option>
                            </select>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>å›½</label>
                                <input type="text" id="supplier-country-0" placeholder="ä¾‹ï¼šæ—¥æœ¬" value="ä¸­å›½">
                            </div>
                            <div class="form-group">
                                <label>å¸‚</label>
                                <input type="text" id="supplier-city-0" placeholder="ä¾‹ï¼šæ±äº¬" value="ä¸Šæµ·">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section-title">
                    å€‰åº«æƒ…å ±
                    <button class="add-btn" onclick="addWarehouse()">+ è¿½åŠ </button>
                </div>
                <div id="warehouses-container">
                    <div class="location-item" data-index="0">
                        <h4>å€‰åº« 1
                            <button class="remove-btn" onclick="removeWarehouse(0)" style="display: none;">å‰Šé™¤</button>
                        </h4>
                        <div class="form-group">
                            <label>å€‰åº«å</label>
                            <input type="text" id="warehouse-name-0" placeholder="ä¾‹ï¼šæ±äº¬ç¬¬ä¸€å€‰åº«" value="æˆç”°ä¿ç¨å€‰åº«">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>å›½å†…/æµ·å¤–</label>
                                <select id="warehouse-location-0" onchange="toggleWarehouseOptions(0)">
                                    <option value="domestic" selected>å›½å†…</option>
                                    <option value="overseas">æµ·å¤–</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>æ—¢å­˜/æ–°è¨­</label>
                                <select id="warehouse-status-0">
                                    <option value="existing" selected>æ—¢å­˜</option>
                                    <option value="new">æ–°è¨­</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>å›½</label>
                                <input type="text" id="warehouse-country-0" placeholder="ä¾‹ï¼šæ—¥æœ¬" value="æ—¥æœ¬">
                            </div>
                            <div class="form-group">
                                <label>å¸‚</label>
                                <input type="text" id="warehouse-city-0" placeholder="ä¾‹ï¼šæ±äº¬" value="æˆç”°">
                            </div>
                        </div>
                        <div id="warehouse-options-0" class="warehouse-options" style="display: block;">
                            <div class="form-group">
                                <label>å€‰åº«ã‚¿ã‚¤ãƒ—</label>
                                <select id="warehouse-type-0">
                                    <option value="general">ä¸€èˆ¬å€‰åº«</option>
                                    <option value="bonded" selected>ä¿ç¨å€‰åº«</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>ä½œæ¥­å†…å®¹</label>
                            <textarea id="warehouse-work-0" placeholder="ä¾‹ï¼šãƒ”ãƒƒã‚­ãƒ³ã‚°ã€ãƒ‘ãƒƒã‚­ãƒ³ã‚°ã€å“è³ªæ¤œæŸ»" rows="2" style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 13px; resize: vertical;">é€šé–¢æ‰‹ç¶šãã€æ¤œæŸ»ã€ä¿ç®¡</textarea>
                        </div>
                        <div class="form-group">
                            <label>æ¸©æ¹¿åº¦ç®¡ç†</label>
                            <select id="temp-control-0" onchange="toggleTempControl(0)">
                                <option value="no">ãªã—</option>
                                <option value="yes">ã‚ã‚Š</option>
                            </select>
                        </div>
                        <div id="temp-control-options-0" class="temp-control-options" style="display: none;">
                            <div class="temp-control-row">
                                <div class="form-group">
                                    <label>è¨­å®šæ¸©åº¦ï¼ˆâ„ƒï¼‰</label>
                                    <input type="text" id="temperature-0" placeholder="ä¾‹ï¼š10-15" value="15-25">
                                </div>
                                <div class="form-group">
                                    <label>è¨­å®šæ¹¿åº¦ï¼ˆ%ï¼‰</label>
                                    <input type="text" id="humidity-0" placeholder="ä¾‹ï¼š60-70" value="40-60">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section-title">
                    ç´å…¥å…ˆæƒ…å ±
                    <button class="add-btn" onclick="addDestination()">+ è¿½åŠ </button>
                </div>
                <div id="destinations-container">
                    <div class="location-item" data-index="0">
                        <h4>ç´å…¥å…ˆ 1
                            <button class="remove-btn" onclick="removeDestination(0)" style="display: none;">å‰Šé™¤</button>
                        </h4>
                        <div class="form-group">
                            <label>ç´å…¥å…ˆå</label>
                            <input type="text" id="destination-name-0" placeholder="ä¾‹ï¼šXYZè£½ä½œæ‰€" value="æ±äº¬è£½é€ æ ªå¼ä¼šç¤¾">
                        </div>
                        <div class="form-group">
                            <label>å›½å†…/æµ·å¤–</label>
                            <select id="destination-location-0">
                                <option value="domestic" selected>å›½å†…</option>
                                <option value="overseas">æµ·å¤–</option>
                            </select>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>å›½</label>
                                <input type="text" id="destination-country-0" placeholder="ä¾‹ï¼šæ—¥æœ¬" value="æ—¥æœ¬">
                            </div>
                            <div class="form-group">
                                <label>å¸‚</label>
                                <input type="text" id="destination-city-0" placeholder="ä¾‹ï¼šå¤§é˜ª" value="æ±äº¬">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section-title">è¼¸é€æƒ…å ±</div>
                <div id="transports-container">
                    <!-- è¼¸é€æƒ…å ±ã¯è‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹ -->
                </div>

                <button class="generate-btn" onclick="generateMap()">ãƒãƒƒãƒ—ç”Ÿæˆ</button>
            </div>

            <div class="map-panel">
                <div class="map-controls">
                    <button class="export-btn" onclick="exportAsImage()">
                        ğŸ“· ç”»åƒã¨ã—ã¦ä¿å­˜
                    </button>
                    <button class="export-btn" onclick="addTextBox()" style="margin-left: 10px; background: linear-gradient(135deg, #7c3aed, #a855f7);">
                        ğŸ“ ãƒ†ã‚­ã‚¹ãƒˆè¿½åŠ 
                    </button>
                    <button class="export-btn" onclick="toggleEditMode()" style="margin-left: 10px; background: linear-gradient(135deg, #059669, #10b981);" id="edit-mode-btn">
                        ğŸ”§ ç·¨é›†ãƒ¢ãƒ¼ãƒ‰
                    </button>
                </div>
                <div class="logistics-map" id="logistics-map">
                    <!-- ãƒãƒƒãƒ—ãŒã“ã“ã«ç”Ÿæˆã•ã‚Œã¾ã™ -->
                </div>
            </div>
        </div>
    </div>

    <script>
        let supplierCount = 1;
        let warehouseCount = 1;
        let destinationCount = 1;

        function addSupplier() {
            const container = document.getElementById('suppliers-container');
            const newSupplier = document.createElement('div');
            newSupplier.className = 'location-item';
            newSupplier.setAttribute('data-index', supplierCount);
            
            newSupplier.innerHTML = `
                <h4>èª¿é”å…ˆ ${supplierCount + 1}
                    <button class="remove-btn" onclick="removeSupplier(${supplierCount})">å‰Šé™¤</button>
                </h4>
                <div class="form-group">
                    <label>èª¿é”å…ˆå</label>
                    <input type="text" id="supplier-name-${supplierCount}" placeholder="ä¾‹ï¼šABCå•†äº‹">
                </div>
                <div class="form-group">
                    <label>å›½å†…/æµ·å¤–</label>
                    <select id="supplier-location-${supplierCount}">
                        <option value="domestic">å›½å†…</option>
                        <option value="overseas">æµ·å¤–</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>å›½</label>
                        <input type="text" id="supplier-country-${supplierCount}" placeholder="ä¾‹ï¼šæ—¥æœ¬">
                    </div>
                    <div class="form-group">
                        <label>å¸‚</label>
                        <input type="text" id="supplier-city-${supplierCount}" placeholder="ä¾‹ï¼šæ±äº¬">
                    </div>
                </div>
            `;
            
            container.appendChild(newSupplier);
            supplierCount++;
            updateRemoveButtons();
            generateTransportForms();
        }

        function removeSupplier(index) {
            const item = document.querySelector(`#suppliers-container .location-item[data-index="${index}"]`);
            if (item) {
                item.remove();
                updateRemoveButtons();
                generateTransportForms();
            }
        }

        function addWarehouse() {
            const container = document.getElementById('warehouses-container');
            const newWarehouse = document.createElement('div');
            newWarehouse.className = 'location-item';
            newWarehouse.setAttribute('data-index', warehouseCount);
            
            newWarehouse.innerHTML = `
                <h4>å€‰åº« ${warehouseCount + 1}
                    <button class="remove-btn" onclick="removeWarehouse(${warehouseCount})">å‰Šé™¤</button>
                </h4>
                <div class="form-group">
                    <label>å€‰åº«å</label>
                    <input type="text" id="warehouse-name-${warehouseCount}" placeholder="ä¾‹ï¼šæ±äº¬ç¬¬ä¸€å€‰åº«">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>å›½å†…/æµ·å¤–</label>
                        <select id="warehouse-location-${warehouseCount}" onchange="toggleWarehouseOptions(${warehouseCount})">
                            <option value="domestic">å›½å†…</option>
                            <option value="overseas">æµ·å¤–</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>æ—¢å­˜/æ–°è¨­</label>
                        <select id="warehouse-status-${warehouseCount}">
                            <option value="existing">æ—¢å­˜</option>
                            <option value="new">æ–°è¨­</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>å›½</label>
                        <input type="text" id="warehouse-country-${warehouseCount}" placeholder="ä¾‹ï¼šæ—¥æœ¬">
                    </div>
                    <div class="form-group">
                        <label>å¸‚</label>
                        <input type="text" id="warehouse-city-${warehouseCount}" placeholder="ä¾‹ï¼šæ±äº¬">
                    </div>
                </div>
                <div id="warehouse-options-${warehouseCount}" class="warehouse-options" style="display: block;">
                    <div class="form-group">
                        <label>å€‰åº«ã‚¿ã‚¤ãƒ—</label>
                        <select id="warehouse-type-${warehouseCount}">
                            <option value="general">ä¸€èˆ¬å€‰åº«</option>
                            <option value="bonded">ä¿ç¨å€‰åº«</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>ä½œæ¥­å†…å®¹</label>
                    <textarea id="warehouse-work-${warehouseCount}" placeholder="ä¾‹ï¼šãƒ”ãƒƒã‚­ãƒ³ã‚°ã€ãƒ‘ãƒƒã‚­ãƒ³ã‚°ã€å“è³ªæ¤œæŸ»" rows="2" style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 13px; resize: vertical;"></textarea>
                </div>
                <div class="form-group">
                    <label>æ¸©æ¹¿åº¦ç®¡ç†</label>
                    <select id="temp-control-${warehouseCount}" onchange="toggleTempControl(${warehouseCount})">
                        <option value="no">ãªã—</option>
                        <option value="yes">ã‚ã‚Š</option>
                    </select>
                </div>
                <div id="temp-control-options-${warehouseCount}" class="temp-control-options" style="display: none;">
                    <div class="temp-control-row">
                        <div class="form-group">
                            <label>è¨­å®šæ¸©åº¦ï¼ˆâ„ƒï¼‰</label>
                            <input type="text" id="temperature-${warehouseCount}" placeholder="ä¾‹ï¼š10-15" value="10-15">
                        </div>
                        <div class="form-group">
                            <label>è¨­å®šæ¹¿åº¦ï¼ˆ%ï¼‰</label>
                            <input type="text" id="humidity-${warehouseCount}" placeholder="ä¾‹ï¼š60-70" value="60-70">
                        </div>
                    </div>
                </div>
            `;
            
            container.appendChild(newWarehouse);
            warehouseCount++;
            updateRemoveButtons();
            generateTransportForms();
        }

        function removeWarehouse(index) {
            const item = document.querySelector(`#warehouses-container .location-item[data-index="${index}"]`);
            if (item) {
                item.remove();
                updateRemoveButtons();
                generateTransportForms();
            }
        }

        function addDestination() {
            const container = document.getElementById('destinations-container');
            const newDestination = document.createElement('div');
            newDestination.className = 'location-item';
            newDestination.setAttribute('data-index', destinationCount);
            
            newDestination.innerHTML = `
                <h4>ç´å…¥å…ˆ ${destinationCount + 1}
                    <button class="remove-btn" onclick="removeDestination(${destinationCount})">å‰Šé™¤</button>
                </h4>
                <div class="form-group">
                    <label>ç´å…¥å…ˆå</label>
                    <input type="text" id="destination-name-${destinationCount}" placeholder="ä¾‹ï¼šXYZè£½ä½œæ‰€">
                </div>
                <div class="form-group">
                    <label>å›½å†…/æµ·å¤–</label>
                    <select id="destination-location-${destinationCount}">
                        <option value="domestic">å›½å†…</option>
                        <option value="overseas">æµ·å¤–</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>å›½</label>
                        <input type="text" id="destination-country-${destinationCount}" placeholder="ä¾‹ï¼šæ—¥æœ¬">
                    </div>
                    <div class="form-group">
                        <label>å¸‚</label>
                        <input type="text" id="destination-city-${destinationCount}" placeholder="ä¾‹ï¼šå¤§é˜ª">
                    </div>
                </div>
            `;
            
            container.appendChild(newDestination);
            destinationCount++;
            updateRemoveButtons();
            generateTransportForms();
        }

        function removeDestination(index) {
            const item = document.querySelector(`#destinations-container .location-item[data-index="${index}"]`);
            if (item) {
                item.remove();
                updateRemoveButtons();
                generateTransportForms();
            }
        }

        function updateRemoveButtons() {
            // èª¿é”å…ˆã®å‰Šé™¤ãƒœã‚¿ãƒ³
            const suppliers = document.querySelectorAll('#suppliers-container .location-item');
            suppliers.forEach((item, index) => {
                const removeBtn = item.querySelector('.remove-btn');
                if (suppliers.length > 1) {
                    removeBtn.style.display = 'inline-block';
                } else {
                    removeBtn.style.display = 'none';
                }
            });

            // å€‰åº«ã®å‰Šé™¤ãƒœã‚¿ãƒ³
            const warehouses = document.querySelectorAll('#warehouses-container .location-item');
            warehouses.forEach((item, index) => {
                const removeBtn = item.querySelector('.remove-btn');
                if (warehouses.length > 1) {
                    removeBtn.style.display = 'inline-block';
                } else {
                    removeBtn.style.display = 'none';
                }
            });

            // ç´å…¥å…ˆã®å‰Šé™¤ãƒœã‚¿ãƒ³
            const destinations = document.querySelectorAll('#destinations-container .location-item');
            destinations.forEach((item, index) => {
                const removeBtn = item.querySelector('.remove-btn');
                if (destinations.length > 1) {
                    removeBtn.style.display = 'inline-block';
                } else {
                    removeBtn.style.display = 'none';
                }
            });
        }

        function generateTransportForms() {
            const container = document.getElementById('transports-container');
            container.innerHTML = '';

            const suppliers = document.querySelectorAll('#suppliers-container .location-item');
            const warehouses = document.querySelectorAll('#warehouses-container .location-item');
            const destinations = document.querySelectorAll('#destinations-container .location-item');

            let transportIndex = 0;

            // èª¿é”å…ˆâ†’å€‰åº«ã®è¼¸é€
            suppliers.forEach((supplier, sIndex) => {
                warehouses.forEach((warehouse, wIndex) => {
                    const supplierIndex = supplier.getAttribute('data-index');
                    const warehouseIndex = warehouse.getAttribute('data-index');
                    const supplierName = document.getElementById(`supplier-name-${supplierIndex}`)?.value || `èª¿é”å…ˆ${parseInt(supplierIndex)+1}`;
                    const warehouseName = document.getElementById(`warehouse-name-${warehouseIndex}`)?.value || `å€‰åº«${parseInt(warehouseIndex)+1}`;

                    const transportItem = document.createElement('div');
                    transportItem.className = 'transport-item';
                    transportItem.innerHTML = `
                        <h4>${supplierName} â†’ ${warehouseName}</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label>è¼¸é€ãƒ¢ãƒ¼ãƒ‰</label>
                                <select id="transport-${transportIndex}-mode">
                                    <option value="truck">ãƒˆãƒ©ãƒƒã‚¯</option>
                                    <option value="ship">æµ·é‹</option>
                                    <option value="air" selected>èˆªç©º</option>
                                    <option value="rail">é‰„é“</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>æ—¢å­˜/æ–°è¨­</label>
                                <select id="transport-${transportIndex}-status">
                                    <option value="existing" selected>æ—¢å­˜</option>
                                    <option value="new">æ–°è¨­</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>å‡ºç™ºæ¸¯</label>
                                <input type="text" id="transport-${transportIndex}-departure" placeholder="ä¾‹ï¼šæ±äº¬æ¸¯" value="ä¸Šæµ·æµ¦æ±ç©ºæ¸¯">
                            </div>
                            <div class="form-group">
                                <label>åˆ°ç€æ¸¯</label>
                                <input type="text" id="transport-${transportIndex}-arrival" placeholder="ä¾‹ï¼šå¤§é˜ªæ¸¯" value="æˆç”°ç©ºæ¸¯">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>è¼¸é€é »åº¦</label>
                                <input type="text" id="transport-${transportIndex}-frequency" placeholder="ä¾‹ï¼šé€±2å›" value="é€±3å›">
                            </div>
                            <div class="form-group">
                                <label>è·å§¿</label>
                                <input type="text" id="transport-${transportIndex}-package" placeholder="ä¾‹ï¼šãƒ‘ãƒ¬ãƒƒãƒˆ" value="ULD">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>ç‰©é‡</label>
                            <input type="text" id="transport-${transportIndex}-volume" placeholder="ä¾‹ï¼š100ã‚±ãƒ¼ã‚¹" value="50ã‚³ãƒ³ãƒ†ãƒŠ">
                        </div>
                        <input type="hidden" id="transport-${transportIndex}-from" value="${supplierIndex}">
                        <input type="hidden" id="transport-${transportIndex}-to" value="${warehouseIndex}">
                        <input type="hidden" id="transport-${transportIndex}-type" value="supplier-warehouse">
                    `;
                    container.appendChild(transportItem);
                    transportIndex++;
                });
            });

            // å€‰åº«â†’ç´å…¥å…ˆã®è¼¸é€
            warehouses.forEach((warehouse, wIndex) => {
                destinations.forEach((destination, dIndex) => {
                    const warehouseIndex = warehouse.getAttribute('data-index');
                    const destinationIndex = destination.getAttribute('data-index');
                    const warehouseName = document.getElementById(`warehouse-name-${warehouseIndex}`)?.value || `å€‰åº«${parseInt(warehouseIndex)+1}`;
                    const destinationName = document.getElementById(`destination-name-${destinationIndex}`)?.value || `ç´å…¥å…ˆ${parseInt(destinationIndex)+1}`;

                    const transportItem = document.createElement('div');
                    transportItem.className = 'transport-item';
                    transportItem.innerHTML = `
                        <h4>${warehouseName} â†’ ${destinationName}</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label>è¼¸é€ãƒ¢ãƒ¼ãƒ‰</label>
                                <select id="transport-${transportIndex}-mode">
                                    <option value="truck" selected>ãƒˆãƒ©ãƒƒã‚¯</option>
                                    <option value="ship">æµ·é‹</option>
                                    <option value="air">èˆªç©º</option>
                                    <option value="rail">é‰„é“</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>æ—¢å­˜/æ–°è¨­</label>
                                <select id="transport-${transportIndex}-status">
                                    <option value="existing" selected>æ—¢å­˜</option>
                                    <option value="new">æ–°è¨­</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>å‡ºç™ºæ¸¯</label>
                                <input type="text" id="transport-${transportIndex}-departure" placeholder="ä¾‹ï¼šå¤§é˜ªæ¸¯" value="æˆç”°å€‰åº«">
                            </div>
                            <div class="form-group">
                                <label>åˆ°ç€æ¸¯</label>
                                <input type="text" id="transport-${transportIndex}-arrival" placeholder="ä¾‹ï¼šç¦å²¡æ¸¯" value="æ±äº¬å·¥å ´">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>è¼¸é€é »åº¦</label>
                                <input type="text" id="transport-${transportIndex}-frequency" placeholder="ä¾‹ï¼šæ¯æ—¥" value="æ¯æ—¥">
                            </div>
                            <div class="form-group">
                                <label>è·å§¿</label>
                                <input type="text" id="transport-${transportIndex}-package" placeholder="ä¾‹ï¼šãƒ€ãƒ³ãƒœãƒ¼ãƒ«" value="ãƒ€ãƒ³ãƒœãƒ¼ãƒ«">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>ç‰©é‡</label>
                            <input type="text" id="transport-${transportIndex}-volume" placeholder="ä¾‹ï¼š500å€‹" value="200å€‹">
                        </div>
                        <input type="hidden" id="transport-${transportIndex}-from" value="${warehouseIndex}">
                        <input type="hidden" id="transport-${transportIndex}-to" value="${destinationIndex}">
                        <input type="hidden" id="transport-${transportIndex}-type" value="warehouse-destination">
                    `;
                    container.appendChild(transportItem);
                    transportIndex++;
                });
            });
        }

        let editMode = false;
        let textBoxCounter = 0;

        function toggleEditMode() {
            editMode = !editMode;
            const mapElement = document.getElementById('logistics-map');
            const editBtn = document.getElementById('edit-mode-btn');
            
            if (editMode) {
                mapElement.classList.add('edit-mode');
                editBtn.innerHTML = 'âœ… ç·¨é›†å®Œäº†';
                editBtn.style.background = 'linear-gradient(135deg, #ef4444, #f87171)';
                enableDragAndDrop();
            } else {
                mapElement.classList.remove('edit-mode');
                editBtn.innerHTML = 'ğŸ”§ ç·¨é›†ãƒ¢ãƒ¼ãƒ‰';
                editBtn.style.background = 'linear-gradient(135deg, #059669, #10b981)';
                disableDragAndDrop();
            }
        }

        function addTextBox() {
            textBoxCounter++;
            const mapElement = document.getElementById('logistics-map');
            const textBox = document.createElement('div');
            textBox.className = 'custom-textbox';
            textBox.contentEditable = true;
            textBox.innerHTML = 'ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›...';
            textBox.style.left = '50px';
            textBox.style.top = '50px';
            textBox.setAttribute('data-textbox-id', textBoxCounter);
            
            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'delete-textbox';
            deleteBtn.innerHTML = 'Ã—';
            deleteBtn.onclick = function() {
                mapElement.removeChild(textBox);
            };
            
            textBox.appendChild(deleteBtn);
            
            textBox.addEventListener('click', function(e) {
                if (!editMode) {
                    this.classList.add('editing');
                    this.focus();
                }
            });
            
            textBox.addEventListener('blur', function() {
                this.classList.remove('editing');
            });
            
            textBox.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    this.blur();
                }
            });
            
            mapElement.appendChild(textBox);
            
            if (editMode) {
                makeElementDraggable(textBox);
            }
        }

        function enableDragAndDrop() {
            const mapElement = document.getElementById('logistics-map');
            const draggableElements = mapElement.querySelectorAll('.location-box, .flow-arrow, .custom-textbox');
            
            draggableElements.forEach(element => {
                makeElementDraggable(element);
            });
        }

        function disableDragAndDrop() {
            const mapElement = document.getElementById('logistics-map');
            const draggableElements = mapElement.querySelectorAll('.location-box, .flow-arrow, .custom-textbox');
            
            draggableElements.forEach(element => {
                element.classList.remove('draggable');
                element.removeAttribute('draggable');
                element.onmousedown = null;
            });
        }

        function makeElementDraggable(element) {
            element.classList.add('draggable');
            let isDragging = false;
            let startX, startY, elementX, elementY;
            
            element.addEventListener('mousedown', function(e) {
                if (!editMode && !element.classList.contains('custom-textbox')) return;
                
                isDragging = true;
                element.classList.add('dragging');
                
                const rect = element.getBoundingClientRect();
                const mapRect = document.getElementById('logistics-map').getBoundingClientRect();
                
                startX = e.clientX;
                startY = e.clientY;
                elementX = rect.left - mapRect.left;
                elementY = rect.top - mapRect.top;
                
                e.preventDefault();
            });
            
            document.addEventListener('mousemove', function(e) {
                if (!isDragging) return;
                
                const deltaX = e.clientX - startX;
                const deltaY = e.clientY - startY;
                
                element.style.position = 'absolute';
                element.style.left = (elementX + deltaX) + 'px';
                element.style.top = (elementY + deltaY) + 'px';
                element.style.zIndex = '999';
            });
            
            document.addEventListener('mouseup', function() {
                if (isDragging) {
                    isDragging = false;
                    element.classList.remove('dragging');
                }
            });
        }

        function toggleWarehouseOptions(index) {
            // ä¿ç¨å€‰åº«é¸æŠãŒå¸¸ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ãŸãŸã‚ã€ã“ã®é–¢æ•°ã¯ä¸è¦
        }

        function toggleTempControl(index) {
            const tempControl = document.getElementById(`temp-control-${index}`).value;
            const tempControlOptions = document.getElementById(`temp-control-options-${index}`);
            
            if (tempControl === 'yes') {
                tempControlOptions.style.display = 'block';
            } else {
                tempControlOptions.style.display = 'none';
            }
        }

        function generateMap() {
            const mapContainer = document.getElementById('logistics-map');
            
            // å„æ‹ ç‚¹ã®ãƒ‡ãƒ¼ã‚¿ã‚’åé›†
            const suppliers = Array.from(document.querySelectorAll('#suppliers-container .location-item')).map(item => {
                const index = item.getAttribute('data-index');
                return {
                    index,
                    name: document.getElementById(`supplier-name-${index}`)?.value || `èª¿é”å…ˆ${parseInt(index)+1}`,
                    location: document.getElementById(`supplier-location-${index}`)?.value || 'domestic',
                    country: document.getElementById(`supplier-country-${index}`)?.value || '',
                    city: document.getElementById(`supplier-city-${index}`)?.value || ''
                };
            });

            const warehouses = Array.from(document.querySelectorAll('#warehouses-container .location-item')).map(item => {
                const index = item.getAttribute('data-index');
                const tempControl = document.getElementById(`temp-control-${index}`)?.value || 'no';
                return {
                    index,
                    name: document.getElementById(`warehouse-name-${index}`)?.value || `å€‰åº«${parseInt(index)+1}`,
                    location: document.getElementById(`warehouse-location-${index}`)?.value || 'domestic',
                    status: document.getElementById(`warehouse-status-${index}`)?.value || 'existing',
                    type: document.getElementById(`warehouse-type-${index}`)?.value || 'general',
                    country: document.getElementById(`warehouse-country-${index}`)?.value || '',
                    city: document.getElementById(`warehouse-city-${index}`)?.value || '',
                    work: document.getElementById(`warehouse-work-${index}`)?.value || '',
                    tempControl,
                    temperature: document.getElementById(`temperature-${index}`)?.value || '10-15',
                    humidity: document.getElementById(`humidity-${index}`)?.value || '60-70'
                };
            });

            const destinations = Array.from(document.querySelectorAll('#destinations-container .location-item')).map(item => {
                const index = item.getAttribute('data-index');
                return {
                    index,
                    name: document.getElementById(`destination-name-${index}`)?.value || `ç´å…¥å…ˆ${parseInt(index)+1}`,
                    location: document.getElementById(`destination-location-${index}`)?.value || 'domestic',
                    country: document.getElementById(`destination-country-${index}`)?.value || '',
                    city: document.getElementById(`destination-city-${index}`)?.value || ''
                };
            });

            // è¼¸é€æƒ…å ±ã‚’åé›†
            const transports = Array.from(document.querySelectorAll('#transports-container .transport-item')).map((item, index) => {
                return {
                    mode: document.getElementById(`transport-${index}-mode`)?.value || 'truck',
                    status: document.getElementById(`transport-${index}-status`)?.value || 'existing',
                    departure: document.getElementById(`transport-${index}-departure`)?.value || '',
                    arrival: document.getElementById(`transport-${index}-arrival`)?.value || '',
                    frequency: document.getElementById(`transport-${index}-frequency`)?.value || '-',
                    package: document.getElementById(`transport-${index}-package`)?.value || '-',
                    volume: document.getElementById(`transport-${index}-volume`)?.value || '-',
                    from: document.getElementById(`transport-${index}-from`)?.value,
                    to: document.getElementById(`transport-${index}-to`)?.value,
                    type: document.getElementById(`transport-${index}-type`)?.value
                };
            });

            // è¼¸é€æƒ…å ±ã‚’åˆ†é¡
            const supplierToWarehouseTransports = transports.filter(t => t.type === 'supplier-warehouse');
            const warehouseToDestinationTransports = transports.filter(t => t.type === 'warehouse-destination');

            // è¼¸é€ãƒ¢ãƒ¼ãƒ‰ã®ã‚¢ã‚¤ã‚³ãƒ³ã¨ãƒ†ã‚­ã‚¹ãƒˆ
            const transportIcons = {
                truck: 'ğŸš›',
                ship: 'ğŸš¢',
                air: 'âœˆï¸',
                rail: 'ğŸš†'
            };

            const transportNames = {
                truck: 'ãƒˆãƒ©ãƒƒã‚¯',
                ship: 'æµ·é‹',
                air: 'èˆªç©º',
                rail: 'é‰„é“'
            };

            let mapHTML = '';

            // æœ€å¤§æ•°ã‚’è¨ˆç®—ã—ã¦ä½ç½®åˆã‚ã›ã«ä½¿ç”¨
            const maxSuppliers = suppliers.length;
            const maxWarehouses = warehouses.length;
            const maxDestinations = destinations.length;

            // èª¿é”å…ˆã‚°ãƒ«ãƒ¼ãƒ—
            mapHTML += '<div class="location-group">';
            suppliers.forEach((supplier) => {
                const locationText = supplier.country || supplier.city ? 
                    `${supplier.country}${supplier.country && supplier.city ? ' ' : ''}${supplier.city}` : 
                    (supplier.location === 'domestic' ? 'å›½å†…' : 'æµ·å¤–');
                
                mapHTML += `
                    <div class="location-box ${supplier.location}" style="position: relative;" data-type="supplier" data-index="${supplier.index}">
                        <div class="location-title">ğŸ­ èª¿é”å…ˆ</div>
                        <div class="location-name">${supplier.name}</div>
                        <div class="location-type ${supplier.location}-tag">
                            ${locationText}
                        </div>
                    </div>
                `;
            });
            mapHTML += '</div>';

            // èª¿é”å…ˆâ†’å€‰åº«ã®è¼¸é€ãƒ¢ãƒ¼ãƒ‰ã‚°ãƒ«ãƒ¼ãƒ—ï¼ˆæ”¹è‰¯ç‰ˆï¼‰
            mapHTML += '<div class="transport-group">';
            
            // å„èª¿é”å…ˆã«å¯¾ã—ã¦1ã¤ãšã¤è¼¸é€ãƒ¢ãƒ¼ãƒ‰ã‚’è¡¨ç¤º
            suppliers.forEach((supplier, sIndex) => {
                // ã“ã®èª¿é”å…ˆã‹ã‚‰ä»»æ„ã®å€‰åº«ã¸ã®è¼¸é€ã‚’æ¢ã™
                const transport = supplierToWarehouseTransports.find(t => t.from === supplier.index);
                
                if (transport) {
                    mapHTML += `
                        <div class="flow-arrow" style="position: relative;" data-type="transport" data-index="supplier-${sIndex}">
                            <div class="transport-info ${transport.mode} ${transport.status}">
                                <div class="transport-icon">${transportIcons[transport.mode]}</div>
                                <div class="flow-label">è¼¸é€ãƒ¢ãƒ¼ãƒ‰</div>
                                <div class="flow-value">${transportNames[transport.mode]}</div>
                                
                                <div class="transport-arrow-container">
                                    <div class="transport-arrow ${transport.status}">â¡</div>
                                </div>
                                
                                <div class="transport-details">
                                    ${transport.departure ? `
                                    <div class="transport-detail-item">
                                        <span class="transport-detail-label">å‡ºç™º:</span>
                                        <span class="transport-detail-value">${transport.departure}</span>
                                    </div>
                                    ` : ''}
                                    ${transport.arrival ? `
                                    <div class="transport-detail-item">
                                        <span class="transport-detail-label">åˆ°ç€:</span>
                                        <span class="transport-detail-value">${transport.arrival}</span>
                                    </div>
                                    ` : ''}
                                    <div class="transport-detail-item">
                                        <span class="transport-detail-label">é »åº¦:</span>
                                        <span class="transport-detail-value">${transport.frequency}</span>
                                    </div>
                                    <div class="transport-detail-item">
                                        <span class="transport-detail-label">è·å§¿:</span>
                                        <span class="transport-detail-value">${transport.package}</span>
                                    </div>
                                    <div class="transport-detail-item">
                                        <span class="transport-detail-label">ç‰©é‡:</span>
                                        <span class="transport-detail-value">${transport.volume}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    // ç©ºã®ã‚¹ãƒšãƒ¼ã‚µãƒ¼ã‚’è¿½åŠ ã—ã¦ä½ç½®åˆã‚ã›
                    mapHTML += '<div class="transport-spacer"></div>';
                }
            });
            mapHTML += '</div>';

            // å€‰åº«ã‚°ãƒ«ãƒ¼ãƒ—
            mapHTML += '<div class="location-group">';
            warehouses.forEach((warehouse) => {
                let warehouseClass = warehouse.location + ' ' + warehouse.status;
                if (warehouse.type === 'bonded') {
                    warehouseClass += ' bonded';
                }

                const locationText = warehouse.country || warehouse.city ? 
                    `${warehouse.country}${warehouse.country && warehouse.city ? ' ' : ''}${warehouse.city}` : 
                    (warehouse.location === 'domestic' ? 'å›½å†…' : 'æµ·å¤–');

                const tempControlInfo = warehouse.tempControl === 'yes' ? `
                    <div class="temp-control-info">
                        <div class="temp-control-title">ğŸŒ¡ï¸ æ¸©æ¹¿åº¦ç®¡ç†</div>
                        <div class="temp-humidity-row">
                            <div class="temp-item">
                                <div class="temp-label">è¨­å®šæ¸©åº¦</div>
                                <div class="temp-value">${warehouse.temperature}â„ƒ</div>
                            </div>
                            <div class="humidity-item">
                                <div class="humidity-label">è¨­å®šæ¹¿åº¦</div>
                                <div class="humidity-value">${warehouse.humidity}%</div>
                            </div>
                        </div>
                    </div>
                ` : '';

                const workInfo = warehouse.work ? `
                    <div class="temp-control-info" style="margin-top: 8px; border-color: #059669;">
                        <div class="temp-control-title" style="color: #059669;">ğŸ”§ ä½œæ¥­å†…å®¹</div>
                        <div style="font-size: 9px; color: #1f2937; line-height: 1.3; text-align: center;">
                            ${warehouse.work}
                        </div>
                    </div>
                ` : '';

                mapHTML += `
                    <div class="location-box ${warehouseClass}" style="position: relative;" data-type="warehouse" data-index="${warehouse.index}">
                        <div class="location-title">ğŸ¬ å€‰åº«</div>
                        <div class="location-name">${warehouse.name}</div>
                        <div class="location-type ${warehouse.location}-tag">
                            ${locationText}${warehouse.type === 'bonded' ? '(ä¿ç¨)' : ''}
                        </div>
                        ${workInfo}
                        ${tempControlInfo}
                    </div>
                `;
            });
            mapHTML += '</div>';

            // å€‰åº«â†’ç´å…¥å…ˆã®è¼¸é€ãƒ¢ãƒ¼ãƒ‰ã‚°ãƒ«ãƒ¼ãƒ—ï¼ˆæ”¹è‰¯ç‰ˆï¼‰
            mapHTML += '<div class="transport-group">';
            
            // å„å€‰åº«ã«å¯¾ã—ã¦1ã¤ãšã¤è¼¸é€ãƒ¢ãƒ¼ãƒ‰ã‚’è¡¨ç¤º
            warehouses.forEach((warehouse, wIndex) => {
                // ã“ã®å€‰åº«ã‹ã‚‰ä»»æ„ã®ç´å…¥å…ˆã¸ã®è¼¸é€ã‚’æ¢ã™
                const transport = warehouseToDestinationTransports.find(t => t.from === warehouse.index);
                
                if (transport) {
                    mapHTML += `
                        <div class="flow-arrow" style="position: relative;" data-type="transport" data-index="warehouse-${wIndex}">
                            <div class="transport-info ${transport.mode} ${transport.status}">
                                <div class="transport-icon">${transportIcons[transport.mode]}</div>
                                <div class="flow-label">è¼¸é€ãƒ¢ãƒ¼ãƒ‰</div>
                                <div class="flow-value">${transportNames[transport.mode]}</div>
                                
                                <div class="transport-arrow-container">
                                    <div class="transport-arrow ${transport.status}">â¡</div>
                                </div>
                                
                                <div class="transport-details">
                                    ${transport.departure ? `
                                    <div class="transport-detail-item">
                                        <span class="transport-detail-label">å‡ºç™º:</span>
                                        <span class="transport-detail-value">${transport.departure}</span>
                                    </div>
                                    ` : ''}
                                    ${transport.arrival ? `
                                    <div class="transport-detail-item">
                                        <span class="transport-detail-label">åˆ°ç€:</span>
                                        <span class="transport-detail-value">${transport.arrival}</span>
                                    </div>
                                    ` : ''}
                                    <div class="transport-detail-item">
                                        <span class="transport-detail-label">é »åº¦:</span>
                                        <span class="transport-detail-value">${transport.frequency}</span>
                                    </div>
                                    <div class="transport-detail-item">
                                        <span class="transport-detail-label">è·å§¿:</span>
                                        <span class="transport-detail-value">${transport.package}</span>
                                    </div>
                                    <div class="transport-detail-item">
                                        <span class="transport-detail-label">ç‰©é‡:</span>
                                        <span class="transport-detail-value">${transport.volume}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    // ç©ºã®ã‚¹ãƒšãƒ¼ã‚µãƒ¼ã‚’è¿½åŠ ã—ã¦ä½ç½®åˆã‚ã›
                    mapHTML += '<div class="transport-spacer"></div>';
                }
            });
            mapHTML += '</div>';

            // ç´å…¥å…ˆã‚°ãƒ«ãƒ¼ãƒ—
            mapHTML += '<div class="location-group">';
            destinations.forEach((destination) => {
                const locationText = destination.country || destination.city ? 
                    `${destination.country}${destination.country && destination.city ? ' ' : ''}${destination.city}` : 
                    (destination.location === 'domestic' ? 'å›½å†…' : 'æµ·å¤–');
                
                mapHTML += `
                    <div class="location-box ${destination.location}" style="position: relative;" data-type="destination" data-index="${destination.index}">
                        <div class="location-title">ğŸª ç´å…¥å…ˆ</div>
                        <div class="location-name">${destination.name}</div>
                        <div class="location-type ${destination.location}-tag">
                            ${locationText}
                        </div>
                    </div>
                `;
            });
            mapHTML += '</div>';

            mapContainer.innerHTML = mapHTML;
        }

        function exportAsImage() {
            const mapElement = document.getElementById('logistics-map');
            const mapPanel = document.querySelector('.map-panel');
            const exportBtn = document.querySelector('.export-btn');
            
            // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
            exportBtn.disabled = true;
            exportBtn.innerHTML = 'ğŸ“· ç”Ÿæˆä¸­...';
            
            // å…ƒã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ä¿å­˜
            const originalMapStyle = {
                overflow: mapElement.style.overflow,
                height: mapElement.style.height,
                maxHeight: mapElement.style.maxHeight,
                width: mapElement.style.width,
                maxWidth: mapElement.style.maxWidth
            };
            
            const originalPanelStyle = {
                overflow: mapPanel.style.overflow,
                height: mapPanel.style.height,
                maxHeight: mapPanel.style.maxHeight
            };
            
            // ã‚­ãƒ£ãƒ—ãƒãƒ£ç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’é©ç”¨
            mapElement.style.overflow = 'visible';
            mapElement.style.height = 'auto';
            mapElement.style.maxHeight = 'none';
            mapElement.style.width = 'max-content';
            mapElement.style.maxWidth = 'none';
            
            mapPanel.style.overflow = 'visible';
            mapPanel.style.height = 'auto';
            mapPanel.style.maxHeight = 'none';
            
            // DOMæ›´æ–°ã‚’å¾…ã¤
            setTimeout(() => {
                // è¦ç´ ã®å®Ÿéš›ã®ã‚µã‚¤ã‚ºã‚’å–å¾—
                const rect = mapElement.getBoundingClientRect();
                const scrollWidth = mapElement.scrollWidth;
                const scrollHeight = mapElement.scrollHeight;
                
                html2canvas(mapElement, {
                    backgroundColor: '#ffffff',
                    scale: 2,
                    useCORS: true,
                    allowTaint: true,
                    width: Math.max(rect.width, scrollWidth, 800),
                    height: Math.max(rect.height, scrollHeight, 400),
                    scrollX: 0,
                    scrollY: 0,
                    x: 0,
                    y: 0,
                    windowWidth: Math.max(scrollWidth + 100, window.innerWidth),
                    windowHeight: Math.max(scrollHeight + 100, window.innerHeight),
                    onclone: function(clonedDoc) {
                        // ã‚¯ãƒ­ãƒ¼ãƒ³ã•ã‚ŒãŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå†…ã§ã‚‚ã‚¹ã‚¿ã‚¤ãƒ«ã‚’èª¿æ•´
                        const clonedMapElement = clonedDoc.getElementById('logistics-map');
                        const clonedMapPanel = clonedDoc.querySelector('.map-panel');
                        
                        if (clonedMapElement) {
                            clonedMapElement.style.overflow = 'visible';
                            clonedMapElement.style.height = 'auto';
                            clonedMapElement.style.maxHeight = 'none';
                            clonedMapElement.style.width = 'max-content';
                            clonedMapElement.style.maxWidth = 'none';
                            clonedMapElement.style.position = 'static';
                        }
                        
                        if (clonedMapPanel) {
                            clonedMapPanel.style.overflow = 'visible';
                            clonedMapPanel.style.height = 'auto';
                            clonedMapPanel.style.maxHeight = 'none';
                        }
                    }
                }).then(function(canvas) {
                    // å…ƒã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å¾©å…ƒ
                    Object.keys(originalMapStyle).forEach(key => {
                        if (originalMapStyle[key]) {
                            mapElement.style[key] = originalMapStyle[key];
                        } else {
                            mapElement.style[key] = '';
                        }
                    });
                    
                    Object.keys(originalPanelStyle).forEach(key => {
                        if (originalPanelStyle[key]) {
                            mapPanel.style[key] = originalPanelStyle[key];
                        } else {
                            mapPanel.style[key] = '';
                        }
                    });
                    
                    // ç”»åƒã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                    const link = document.createElement('a');
                    link.download = `ç‰©æµãƒãƒƒãƒ—_${new Date().toISOString().slice(0, 10)}.png`;
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                    
                    // ãƒœã‚¿ãƒ³ã‚’å…ƒã«æˆ»ã™
                    exportBtn.disabled = false;
                    exportBtn.innerHTML = 'ğŸ“· ç”»åƒã¨ã—ã¦ä¿å­˜';
                }).catch(function(error) {
                    console.error('ç”»åƒç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
                    alert('ç”»åƒã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
                    
                    // ã‚¨ãƒ©ãƒ¼æ™‚ã‚‚å…ƒã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å¾©å…ƒ
                    Object.keys(originalMapStyle).forEach(key => {
                        if (originalMapStyle[key]) {
                            mapElement.style[key] = originalMapStyle[key];
                        } else {
                            mapElement.style[key] = '';
                        }
                    });
                    
                    Object.keys(originalPanelStyle).forEach(key => {
                        if (originalPanelStyle[key]) {
                            mapPanel.style[key] = originalPanelStyle[key];
                        } else {
                            mapPanel.style[key] = '';
                        }
                    });
                    
                    // ãƒœã‚¿ãƒ³ã‚’å…ƒã«æˆ»ã™
                    exportBtn.disabled = false;
                    exportBtn.innerHTML = 'ğŸ“· ç”»åƒã¨ã—ã¦ä¿å­˜';
                });
            }, 100);
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åˆæœŸåŒ–
        window.onload = function() {
            generateTransportForms();
            generateMap();
        };
    </script>
</body>
</html>