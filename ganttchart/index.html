<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>インタラクティブガントチャート</title>
    <link rel="stylesheet" href="../styles/ganttchart.css">
</head>
<body>
    <div class="app-header">
        <input type="text" class="project-title" id="projectTitle" value="プロジェクト管理表" 
               placeholder="プロジェクト名を入力">
    </div>
    
    <div class="toolbar">
        <button class="btn" onclick="addTask()">
            ➕ タスク追加
        </button>
        <button class="btn btn-success" onclick="addSubTask()">
            ➕ サブタスク追加
        </button>
        <div class="file-input-wrapper">
            <label class="btn btn-info file-input-label">
                📂 インポート
                <input type="file" id="importFile" accept=".json,.xml" onchange="importData(event)">
            </label>
        </div>
        <button class="btn btn-success" onclick="exportData()">
            💾 エクスポート
        </button>
        <button class="btn" onclick="toggleView()">
            📅 表示切替
        </button>
        <button class="btn" onclick="undoAction()" title="元に戻す (Ctrl+Z)">
            ↩️ 元に戻す
        </button>
        <button class="btn" onclick="redoAction()" title="やり直し (Ctrl+Y)">
            ↪️ やり直し
        </button>
        
        <div class="status-info">
            <span>総タスク数: <span class="status-badge" id="task-count">0</span></span>
            <span>進捗率: <span class="status-badge" id="overall-progress">0%</span></span>
        </div>
    </div>
    
    <div class="gantt-container">
        <div id="gantt_here"></div>
    </div>

    <!-- Add Task Modal -->
    <div id="taskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">新しいタスクを追加</h3>
                <span class="close" onclick="closeTaskModal()">&times;</span>
            </div>
            <form id="taskForm">
                <div class="form-group">
                    <label for="taskText">タスク名:</label>
                    <input type="text" id="taskText" name="text" required placeholder="短いタスク名を入力">
                </div>
                <div class="form-group">
                    <label for="taskDescription">タスク内容:</label>
                    <textarea id="taskDescription" name="description" rows="3" placeholder="詳細な内容・説明を入力" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; font-family: inherit; resize: vertical;"></textarea>
                </div>
                <div class="form-group">
                    <label for="taskStartDate">開始日:</label>
                    <input type="date" id="taskStartDate" name="start_date" required>
                </div>
                <div class="form-group">
                    <label for="taskEndDate">終了日:</label>
                    <input type="date" id="taskEndDate" name="end_date" required>
                </div>
                <div class="form-group">
                    <label for="taskPriority">優先度:</label>
                    <select id="taskPriority" name="priority">
                        <option value="low">🟢 低</option>
                        <option value="medium" selected>🟡 中</option>
                        <option value="high">🔴 高</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="taskProgress">進捗 (%):</label>
                    <input type="number" id="taskProgress" name="progress" min="0" max="100" value="0">
                </div>
                <div class="form-group">
                    <label for="taskDepartment">担当箇所:</label>
                    <input type="text" id="taskDepartment" name="department" placeholder="担当箇所を入力">
                </div>
                <div class="modal-buttons" style="display: flex; justify-content: space-between; margin-top: 20px; padding-top: 15px; border-top: 1px solid #eee; background: white; position: sticky; bottom: 0;">
                    <button type="submit" class="btn btn-success">タスク保存</button>
                    <button type="button" class="btn" onclick="closeTaskModal()">キャンセル</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Context Menu -->
    <div id="contextMenu" class="context-menu">
        <div class="context-menu-item" onclick="editTask()">📝 編集</div>
        <div class="context-menu-item" onclick="addSubTask()">➕ サブタスク追加</div>
        <div class="context-menu-item" onclick="deleteTask()">🗑️ 削除</div>
        <div class="context-menu-item" onclick="duplicateTask()">📋 複製</div>
        <div class="context-menu-item" onclick="linkTasks()">🔗 依存関係追加</div>
    </div>

    <!-- Gantt.js library -->
    <script src="https://cdn.dhtmlx.com/gantt/edge/dhtmlxgantt.js"></script>
    <script src="gantt.js"></script>
</body>
</html>